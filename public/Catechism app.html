<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catechumen</title>
    <style>
        /* --- Existing Catechism App Styles --- */
        body {
            font-family: 'Georgia', serif;
            text-shadow: 1px 1px 4px #000;
            background-color: #3a6646;
            background-image: radial-gradient(50% 104%, #457654 46%, #21412A 100%);
            color: white;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh; /* Ensure body takes full viewport height */
            display: flex;
            flex-direction: column;
            pointer-events: auto;
            overflow-x: hidden; /* Prevent horizontal scroll during animation */
        }

        header {
            text-align: center;
            background-color: #9C8547; /* Navy blue for Catholic theme */
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        header h1 {
            margin: 0;
            font-size: 2em;
        }
        
        nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            margin-bottom: 20px;
        }
        button {
            background-color: #7b6b30;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1em;
            /* Enhanced Button Hover Effect */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #5f5429;
            transform: translateY(-2px); /* Subtle lift effect */
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
            opacity: 0.7;
        }
        /* Main content sections container */
        .main-content-container {
            position: relative; /* For positioning internal sections */
            flex-grow: 1;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: none;        /* Hidden by default */
            opacity: 0;           /* Invisible initially */
            justify-content: center;
            align-items: flex-start;
            transition: opacity 1s ease-in-out;
        }

        /* This class will be added by JS after splash screen */
        .main-content-container.visible {
            display: flex; /* Or block, depending on desired layout */
            opacity: 1;
        }

        section {
            background: #9C8547;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            /* Smooth Section Transitions */
            opacity: 1;
            visibility: visible; /* Default visible */
            transition: opacity 1s ease-in-out;
            position: relative; /* Keep absolute for transitions, but manage parent */
            width: 100%; /* Take full width of its relative parent */
            top: 0; /* Align to top of parent */
            left: 0; /* Align to left of parent */
            box-sizing: border-box; /* Include padding in width */
        }
        /* The .hidden class is crucial for hiding sections with transitions */
        section.hidden {
            opacity: 0;
            visibility: hidden; /* Hide element visually and from screen readers */
            pointer-events: none; /* Disable interactions when hidden */
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
        }
        .quiz-question {
            margin-bottom: 20px;
        }
        .quiz-option {
            display: block;
            margin: 5px 0;
        }
        pre {
            white-space: pre-wrap;
            font-family: inherit;
        }
        .lesson-content {
            margin-bottom: 20px;
        }
        .video-placeholder {
            background-color: transparent;
            padding: 0;
            margin: 0;
            border: none;
            text-align: center;
            overflow: hidden;
        }

        /* --- Custom Alert Modal Styles --- */
        #custom-alert-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 10000; /* EXTREMELY HIGH */
            max-width: 350px;
            text-align: center;
            color: #333;
            animation: fadeIn 0.3s ease-out;
            pointer-events: auto;
        }
        #custom-alert-modal .alert-message {
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
        }
        #custom-alert-modal .alert-ok-button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        #custom-alert-modal .alert-ok-button:hover {
            background-color: #5f5429;
        }
        /* Animation for custom alert */
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translate(-50%, -50%); }
            to { opacity: 0; transform: translate(-50%, -60%); }
        }
        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        /* Rule to hide the custom alert modal when it has the 'hidden' class */
        #custom-alert-modal.hidden {
            display: none;
        }

        /* Alert Overlay for Custom Alert */
        #alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Slightly darker for alerts */
            z-index: 9999; /* Just below the custom alert */
            display: none; /* Hidden by default */
            pointer-events: auto;
        }
        #alert-overlay.active {
            display: block;
        }

        /* --- Integrated Chat Section Styles --- */
        /* This section now combines the previous #chat-section and #firebase-chat-section */
        #chat-section { 
            width: 100%; /* Take full width of its parent .main-content-container */
            max-width: 900px; /* Match other sections */
            margin: 0 auto; /* Center it */
            height: auto; /* Allow height to adjust to content */
            min-height: 400px; /* Ensure some minimum height */
            background-color: #f0f0f0; /* Light background for the chat box */
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1; /* Normal stacking context within main-content-container */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Hide scrollbars if content overflows */
            padding: 20px; /* Inner padding */
            box-sizing: border-box; /* Include padding in width/height */
            color: #333; /* Dark text for readability on light background */
            text-shadow: none; /* Remove text shadow for chat content */
        }

        /* --- Chat Widget Inner Styles (adapted from your provided snippet) --- */
        #chat-section .chat-container { /* Target chat-container inside chat-section */
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%; /* Take full width of section */
            height: 100%; /* Take full height of section */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }
        #chat-section .chat-header { /* This was .p-4.bg-blue-600 in your snippet, adapted to a class */
            background-color: #3a6646; /* Green for chat header */
            color: white;
            text-align: center;
            font-size: 1.5em; /* Adjusted font size */
            font-weight: bold;
            padding: 1rem;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
        }
        
        #chat-section .messages-area {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            max-height: none; /* Allow messages area to fill available space in section */
            min-height: 10rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            background-color: #f9fafb;
            border-bottom: 1px solid #e0e0e0;
        }
        #chat-section .message-bubble {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        #chat-section .message-bubble.sent {
            background-color: #dbeafe;
            align-self: flex-end;
            color: #1e40af;
        }
        #chat-section .message-bubble.received {
            background-color: #f3f4f6;
            align-self: flex-start;
            color: #374151;
        }
        #chat-section .message-sender {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #6b7280;
        }
        #chat-section .input-area {
            padding: 1.5rem;
            display: flex;
            gap: 0.75rem;
            background-color: #ffffff;
            border-bottom-left-radius: 0.75rem; /* Match section border radius */
            border-bottom-right-radius: 0.75rem; /* Match section border radius */
        }
        #chat-section .input-area input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        #chat-section .input-area input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        #chat-section .input-area button {
            background-color: #9C8547; /* Blue button */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #chat-section .input-area button:hover {
            background-color: #5f5429;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        #chat-section .loading-message {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        #close-chat-button { /* Still needed if you want a close button within the integrated chat */
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #dc3545; /* Red for close button */
            color: white;
            border: none;
            border-radius: 50%; /* Make it round */
            width: 30px;
            height: 30px;
            font-size: 1em;
            line-height: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        #close-chat-button:hover {
            background-color: #5f5429;
        }

        /* --- Username/Class Input Specific Styles --- */
        #chat-section .user-status-area {
            padding: 10px 15px;
            background-color: #e2e8f0; /* Light gray-blue */
            border-bottom: 1px solid #cbd5e0;
            text-align: center;
            font-size: 0.9em;
            color: #4a5568;
        }
        #chat-section #username-class-input-area { /* New ID for combined input area */
            display: flex;
            flex-direction: column; /* Stack inputs vertically */
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }
        #chat-section #username-input,
        #chat-section #class-input { /* Apply styles to both inputs */
            padding: 8px 12px;
            border: 1px solid #a0aec0;
            border-radius: 5px;
            flex-grow: 1;
            width: 80%; /* Make them take more width */
            max-width: 250px; /* Limit input width */
        }
        #chat-section #save-profile-button { /* Renamed button */
            background-color: #9C8547; /* Green for save */
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        #chat-section #save-profile-button:hover {
            background-color: #5f5429;
        }
        #chat-section .user-id-display {
            font-size: 0.8em;
            color: #6a6a6a;
            margin-top: 5px;
        }

        /* --- Rosary Section Specific Styles --- */
        #rosary-section {
            background: #D4AF37; /* Gold/Brass color for rosary section */
            color: #333;
            text-align: center;
            padding: 30px;
            min-height: 300px; /* Ensure enough height for content */
            justify-content: flex-start; /* Align content to top within flex container */
        }
        #rosary-section h2 {
            font-size: 2.2em;
            text-shadow: none;
            margin-bottom: 20px;
            color: #6A0505; /* Deep red for titles */
        }
        #rosary-controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        #rosary-controls button {
            background-color: #8B4513; /* SaddleBrown for rosary buttons */
            color: white;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #rosary-controls button:hover {
            background-color: #5f5429; /* Darker brown on hover */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .rosary-display-content { /* Renamed from #rosary-display to be a class */
            margin-top: 30px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            text-shadow: none;
            color: #333;
            text-align: left;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .rosary-display-content h3 {
            font-size: 1.8em;
            color: #6A0505;
            text-shadow: none;
            margin-bottom: 15px;
            text-align: center;
        }
        .rosary-display-content p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 10px;
            text-align: center;
        }
        .rosary-display-content .scripture {
            font-style: italic;
            color: #555;
            text-shadow: none;
            margin-top: 15px;
            white-space: pre-wrap; /* Preserve line breaks in scripture */
        }
        .rosary-display-content .rosary-current-prayer {
            font-weight: bold;
            text-shadow: none;
            color: #21412A;
        }

    /* --- Splash Screen Styles --- */
    #splash-screen {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        background-color: #21412A;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        opacity: 1; /* Start opaque */
        transition: opacity 1s ease-out; /* For fade-out */
        pointer-events: auto;
    }

    #splash-screen.fade-out {
        opacity: 0;
        pointer-events: none; /* Disable interactions after fade out starts */
    }

        #splash-title-banner {
            color: #ffffff;
            font-family: 'Georgia', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            text-align: center;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
            /* Combined animation for smoother flow */
            animation: bannerIntroAnimation 4s ease-in-out forwards; 
        }

        #splash-title-banner h1 {
            margin: 0;
            font-size: 1em; /* Relative to parent font-size */
            font-weight: 700;
            text-transform: uppercase;
        }

        /* New combined animation for the banner */
        @keyframes bannerIntroAnimation {
            0% {
                opacity: 0;
                transform: scale(0.1);
            }
            70% { /* Swell up to max, then immediately starts shrinking */
                opacity: 1;
                transform: scale(2.2);
            }
            100% { /* Shrink and fade out */
                opacity: 0;
                transform: scale(0.1);
            }
        }

        /* Footer styles for the Quit button */
        footer {
            text-align: center;
            padding: 10px 0;
            margin-top: auto; /* Pushes footer to the bottom */
            width: 100%;
            box-sizing: border-box;
        }

        /* --- Common Prayers Section Specific Styles --- */
        #prayers-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Center buttons horizontally */
            gap: 10px; /* Space between buttons */
            padding: 0; /* Remove default ul padding */
            margin-top: 20px; /* Add some space above the buttons */
        }

        #prayers-list li {
            margin: 0; /* Remove default li margin, replaced by gap */
        }

        #prayers-list button {
            flex-grow: 1; /* Allow buttons to grow to fill space */
            min-width: 150px; /* Minimum width for buttons */
            max-width: 200px; /* Max width to prevent them from becoming too wide */
        }
    </style>

    <!-- Firebase SDKs and Chat Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Your web app's Firebase configuration - REPLACE THESE WITH YOUR ACTUAL VALUES
        // This is the fallback if __firebase_config is not provided by the Canvas environment.
        // You've already provided your actual values, so they are used here directly.
        let firebaseConfig = {
             apiKey: "AIzaSyA7B17UFVuvxOUmK81MCkSwwTzXiXeySlk",
  authDomain: "ocia-application.firebaseapp.com",
  projectId: "ocia-application",
  storageBucket: "ocia-application.firebasestorage.app",
  messagingSenderId: "113168534647",
  appId: "1:113168534647:web:ac363f4f89185b6ac88a72",
  measurementId: "G-WRGSXQCY5D"
        };

        // This block attempts to use the Firebase config provided by the Canvas environment.
        // It will override the above 'firebaseConfig' if __firebase_config is defined and valid.
        if (typeof __firebase_config !== 'undefined' && __firebase_config) {
            try {
                const parsedConfig = JSON.parse(__firebase_config);
                if (parsedConfig && parsedConfig.projectId) { // Basic validation
                    firebaseConfig = parsedConfig;
                    console.log("Using Firebase config provided by environment.");
                } else {
                    console.warn("Provided __firebase_config is invalid or missing projectId. Using hardcoded config.");
                }
            } catch (e) {
                console.error("Error parsing __firebase_config:", e);
                console.warn("Using hardcoded Firebase config due to parsing error.");
            }
        } else {
            console.warn("No __firebase_config provided by environment. Using hardcoded config.");
        }

        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app; // These are declared here and assigned inside initializeFirebase
        let db;
        let auth;
        let currentUserId = null;
        let isAuthReady = false;

        // Get elements within the #firebase-chat-section
        const messagesArea = document.querySelector('#firebase-chat-section #messages-area');
        const messageInput = document.querySelector('#firebase-chat-section #message-input');
        const sendButton = document.querySelector('#firebase-chat-section #send-button');
        const loadingIndicator = document.querySelector('#firebase-chat-section #loading-indicator');

        /**
         * Initializes Firebase and sets up authentication.
         */
        async function initializeFirebase() {
            try {
                // Initialize Firebase app
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Listen for authentication state changes
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log("Firebase authenticated. User ID:", currentUserId);
                        isAuthReady = true;
                        if (loadingIndicator) { // Check if element exists before removing
                            loadingIndicator.remove();
                        }
                        setupRealtimeListener(); // Start listening for messages
                    } else {
                        // If no user is signed in, try to sign in with custom token or anonymously
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                                console.log("Signed in with custom token.");
                            } else {
                                await signInAnonymously(auth);
                                console.log("Signed in anonymously.");
                            }
                        } catch (error) {
                            console.error("Error signing in:", error);
                            if (messagesArea) {
                                messagesArea.innerHTML = `<div class="loading-message text-red-500">Error: Could not sign in. ${error.message}</div>`;
                            }
                        }
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                if (messagesArea) {
                    messagesArea.innerHTML = `<div class="loading-message text-red-500">Error: Firebase initialization failed. ${error.message}</div>`;
                }
            }
        }

        /**
         * Sets up a real-time listener for messages from Firestore.
         */
        function setupRealtimeListener() {
            // Ensure Firebase is initialized and user is authenticated before setting up listener
            if (!db || !currentUserId) {
                console.warn("Firestore or User ID not ready for listener setup.");
                return;
            }

            const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
            const q = query(messagesCollectionRef, orderBy('timestamp', 'asc')); // Order by timestamp

            onSnapshot(q, (snapshot) => {
                if (messagesArea) {
                    messagesArea.innerHTML = ''; // Clear existing messages
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        displayMessage(message);
                    });
                    // Scroll to the bottom of the messages area
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                }
            }, (error) => {
                console.error("Error listening to messages:", error);
                if (messagesArea) {
                    messagesArea.innerHTML = `<div class="loading-message text-red-500">Error loading messages: ${error.message}</div>`;
                }
            });
        }

        /**
         * Displays a single message in the chat area.
         * @param {object} message - The message object containing text, senderId, and timestamp.
         */
        function displayMessage(message) {
            if (!messagesArea) return; // Ensure messagesArea exists

            const messageElement = document.createElement('div');
            messageElement.classList.add('message-bubble');

            // Determine if the message was sent by the current user
            const isSentByCurrentUser = message.senderId === currentUserId;
            if (isSentByCurrentUser) {
                messageElement.classList.add('sent');
            } else {
                messageElement.classList.add('received');
            }

            // Display sender ID (or "You" for current user)
            const senderIdDisplay = isSentByCurrentUser ? 'You' : `User: ${message.senderId ? message.senderId.substring(0, 8) + '...' : 'Unknown'}`;
            const senderElement = document.createElement('div');
            senderElement.classList.add('message-sender');
            senderElement.textContent = senderIdDisplay;
            messageElement.appendChild(senderElement);

            // Display message text
            const textElement = document.createElement('div');
            textElement.textContent = message.text;
            messageElement.appendChild(textElement);

            messagesArea.appendChild(messageElement);
        }

        /**
         * Sends a new message to Firestore.
         */
        async function sendMessage() {
            if (!isAuthReady || !currentUserId || !messageInput) {
                console.warn("Firebase not ready, user not authenticated, or message input not found to send message.");
                return;
            }

            const messageText = messageInput.value.trim();
            if (messageText === '') {
                return; // Don't send empty messages
            }

            try {
                const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
                await addDoc(messagesCollectionRef, {
                    text: messageText,
                    senderId: currentUserId,
                    timestamp: serverTimestamp() // Firestore server timestamp
                });
                messageInput.value = ''; // Clear input field
            } catch (error) {
                console.error("Error sending message:", error);
                // In a real app, you'd show a user-friendly error message here
            }
        }

        // Event listeners for sending messages, ensuring elements exist
        if (sendButton) {
            sendButton.addEventListener('click', sendMessage);
        }
        if (messageInput) {
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        // Initialize Firebase when the DOM content is fully loaded
        // This ensures all HTML elements are available before script tries to access them
        document.addEventListener('DOMContentLoaded', initializeFirebase);
    </script>
</head>
<body>

<!-- Splash Screen HTML -->
<div id="splash-screen">
    <div id="splash-title-banner">
        <h1>CATECHUMEN</h1>
    </div>
</div>

<header>
    <h1>CATECHUMEN</h1>
</header>
<nav>
    <button id="home-nav-button">Home</button>
    <button id="lessons-nav-button">Lessons & Quizzes</button>
    <button id="spiritual-nav-button">Spiritual Formation</button>
    <button id="chat-menu-button">Chat</button> <!-- Renamed for consistency -->
    <button id="resources-nav-button">Student Resources</button>
</nav>

<!-- Main content container for sections -->
<div class="main-content-container">
    <section id="main-menu-section">
        <h2>Welcome to Catechumen!</h2>
        <p>Use the navigation above to explore the app.</p>
    </section>

    <!-- Lessons List Section -->
    <section id="lessons-list-section" class="hidden">
        <h2 id="lessons-section-title">Lessons & Quizzes</h2>
        <h3 id="lessons-category-title">Select a category:</h3>
        <ul id="lessons-category-list">
            <!-- Category buttons will be rendered here by JavaScript -->
        </ul>
        <ul id="lessons-list">
            <!-- Lesson items will be rendered here by JavaScript -->
        </ul>
        <button id="back-to-categories-button" class="hidden">Back to Categories</button>
    </section>

    <!-- Current Lesson View Section (formerly inside lessons-section) -->
    <section id="lesson-content-section" class="hidden">
        <h3 id="current-lesson-title"></h3>
        <div id="current-lesson-content" class="lesson-content"></div>
        <div class="video-placeholder hidden">
            <iframe id="lesson-video" width="560" height="315" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
        <button id="take-quiz-button">Take Quiz</button>
        <button id="back-to-lessons-list-button">Back to Lessons</button>
    </section>

    <section id="quiz-section" class="hidden">
        <h2 id="quiz-title"></h2>
        <div id="quiz-questions-container">
        </div>
        <button id="submit-quiz-button">Submit Quiz</button>
        <button id="back-to-lesson-from-quiz-button">Back to Lesson</button>
    </section>

    <section id="spiritual-formation-section" class="hidden">
        <h2>Spiritual Formation</h2>
        <ul>
            <li><button onclick="showSection('daily-section')">Lectio Divina</button></li>
            <li><button onclick="showSection('rosary-main-section')">Guided Rosary</button></li>
            <li><button onclick="showSection('prayers-section')">Common Prayers</button></li>
            <li><button onclick="showSection('lotH-section')">Liturgy of the Hours</button></li>
        </ul>
        <button onclick="showSection('main-menu-section')">Back to Main Menu</button>
    </section>

    <section id="rosary-main-section" class="hidden"> <!-- Renamed from #rosary-section to avoid conflict with rosary functionality section -->
        <h2>Guided Rosary</h2>
        <div class="video-placeholder">
            <iframe width="560" height="315" src="https://placehold.co/560x315/cccccc/333333?text=Guided+Rosary+Video" title="Guided Rosary Video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
        <p>Choose Mysteries:</p>
        <ul>
            <li><button onclick="startRosary('Joyful')">Joyful (Monday & Saturday)</button></li>
            <li><button onclick="startRosary('Sorrowful')">Sorrowful (Tuesday & Friday)</button></li>
            <li><button onclick="startRosary('Glorious')">Glorious (Wednesday & Sunday)</button></li>
            <li><button onclick="startRosary('Luminous')">Luminous (Thursday)</button></li>
        </ul>
        <div id="rosary-progress" class="hidden"></div>
        <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Formation</button>
    </section>

    <!-- Specific Rosary Mystery Sections (will be managed by JS, not direct showSection from nav) -->
    <section id="joyful-rosary-section" class="hidden">
        <h2>Joyful Mysteries</h2>
        <div id="joyful-display" class="rosary-display-content"></div>
        <div id="rosary-controls-joyful" class="rosary-controls">
            <button id="joyful-next-button">Next Prayer</button>
            <button onclick="showSection('rosary-main-section')">Back to Mysteries</button>
            <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Menu</button>
        </div>
    </section>

    <section id="sorrowful-rosary-section" class="hidden">
        <h2>Sorrowful Mysteries</h2>
        <div id="sorrowful-display" class="rosary-display-content"></div>
        <div id="rosary-controls-sorrowful" class="rosary-controls">
            <button id="sorrowful-next-button">Next Prayer</button>
            <button onclick="showSection('rosary-main-section')">Back to Mysteries</button>
            <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Menu</button>
        </div>
    </section>

    <section id="glorious-rosary-section" class="hidden">
        <h2>Glorious Mysteries</h2>
        <div id="glorious-display" class="rosary-display-content"></div>
        <div id="rosary-controls-glorious" class="rosary-controls">
            <button id="glorious-next-button">Next Prayer</button>
            <button onclick="showSection('rosary-main-section')">Back to Mysteries</button>
            <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Menu</button>
        </div>
    </section>

    <section id="luminous-rosary-section" class="hidden">
        <h2>Luminous Mysteries</h2>
        <div id="luminous-display" class="rosary-display-content"></div>
        <div id="rosary-controls-luminous" class="rosary-controls">
            <button id="luminous-next-button">Next Prayer</button>
            <button onclick="showSection('rosary-main-section')">Back to Mysteries</button>
            <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Menu</button>
        </div>
    </section>
    
    <section id="student-resources-section" class="hidden">
        <h2>Student Resources</h2>
        <ul>
            <li><a href="https://usccb.cld.bz/Catechism-of-the-Catholic-Church/" target="_blank"><button>Catechism of the Catholic Church</button></a></li>
            <li><a href="https://bible.usccb.org/bible" target="_blank"><button>Holy Bible</button></a></li>
            <li><a href="https://www.catholic.com/" target="_blank"><button>Catholic Answers</button></a></li>
            <li><a href="https://catechisminayear.fireside.fm/" target="_blank"><button>Catechism in a Year with Fr. Mike Schmitz</button></a></li>
        </ul>
        <button onclick="showSection('main-menu-section')">Back to Main Menu</button>
    </section>
    
    <section id="daily-section" class="hidden"> <!-- Renamed from #daily -->
        <h2>Lectio Divina</h2>
        <div class="video-placeholder">
            <iframe width="560" height="315" src="https://placehold.co/560x315/cccccc/333333?text=Lectio+Divina+Video" title="Lectio Divina Video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
        <p><strong>Consider reading and praying with one of the Church's daily readings.</strong></p>
        <div class="cg_mrc_widget"></div>
        <script src="https://cdn1.catholicgallery.org/wp-content/uploads/widgets/rich-card/cg_mrc_widget.js" async></script>
        <p><strong>Lectio (Read) Slowly and attentively.</strong></p>
        <p><strong>Meditatio (Meditate) Reflect on words or a phrase.</strong></p>
        <p><strong>Oratio (Pray) Talk and listen to God.</strong></p>
        <p><strong>Contemplatio (Compemplate) Rest in God. Savor His love.</strong></p>
        <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Formation</button>
    </section>
    
    <section id="lotH-section" class="hidden"> <!-- Renamed from #lotH -->
        <h2>Liturgy of the Hours</h2>
        <p>The Liturgy of the Hours, also known as the Divine Office, is the official prayer of the Catholic Church that sanctifies the day through Psalms, Scripture readings, hymns, and intercessions. It is prayed at fixed times throughout the day, uniting the faithful in continuous praise and petition. Rooted in ancient tradition and emphasized in Vatican II's Sacrosanctum Concilium, it fosters a deeper communion with Christ and the Church. Use the widget below to access today's prayers in English.</p>
        <iframe src="https://www.ibreviary.com/m2/breviario.php?lang=en" width="340" height="500" style="border: 1px solid #151515;"></iframe>
        <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Formation</button>
    </section>

    <section id="prayers-section" class="hidden"> <h2 id="prayer-title">Common Catholic Prayers</h2>
        <!-- Moved prayer-text here to appear above buttons -->
        <pre id="prayer-text" class="hidden"></pre>
        <ul id="prayers-list">
            <li><button onclick="showPrayer('Sign of the Cross')">Sign of the Cross</button></li>
            <li><button onclick="showPrayer('Our Father')">Our Father</button></li>
            <li><button onclick="showPrayer('Hail Mary')">Hail Mary</button></li>
            <li><button onclick="showPrayer('Glory Be')">Glory Be</button></li>
            <li><button onclick="showPrayer('Apostles\' Creed')">Apostles' Creed</button></li>
            <li><button onclick="showPrayer('Nicene Creed')">Nicene Creed</button></li>
            <li><button onclick="showPrayer('Act of Contrition')">Act of Contrition</button></li>
            <li><button onclick="showPrayer('Hail Holy Queen')">Hail Holy Queen</button></li>
            <li><button onclick="showPrayer('Memorare')">Memorare</button></li>
            <li><button onclick="showPrayer('Angelus')">Angelus</button></li>
            <li><button onclick="showPrayer('Prayer to St. Michael')">Prayer to St. Michael</button></li>
            <li><button onclick="showPrayer('Anima Christi')">Anima Christi</button></li>
            <li><button onclick="showPrayer('Guardian Angel Prayer')">Guardian Angel Prayer</button></li>
            <li><button onclick="showPrayer('Grace Before Meals')">Grace Before Meals</button></li>
            <li><button onclick="showPrayer('Grace After Meals')">Grace After Meals</button></li>
            <li><button onclick="showPrayer('Morning Offering')">Morning Offering</button></li>
            <li><button onclick="showPrayer('Act of Faith')">Act of Faith</button></li>
            <li><button onclick="showPrayer('Act of Hope')">Act of Hope</button></li>
            <li><button onclick="showPrayer('Act of Love')">Act of Love</button></li>
            <li><button onclick="showPrayer('Fatima Prayer')">Fatima Prayer</button></li>
            <li><button onclick="showPrayer('Come Holy Spirit')">Come Holy Spirit</button></li>
            <li><button onclick="showPrayer('Eternal Rest')">Eternal Rest</button></li>
            <li><button onclick="showPrayer('Divine Praises')">Divine Praises</button></li>
            <li><button onclick="showPrayer('Confiteor')">Confiteor</button></li>
        </ul>
        <button id="back-to-prayers-list-button" class="hidden">Back to List</button>
        <button onclick="showSection('spiritual-formation-section')">Back to Spiritual Menu</button>
    </section>

    <!-- Consolidated Chat Section -->
    <section id="chat-section" class="hidden">
        <div class="chat-container">
            <div class="chat-header">Catechumen Chat</div>
            <div class="user-status-area">
                <span id="chat-user-id">User ID: Loading...</span> | 
                <span id="chat-username-display">Username: Loading...</span> | 
                <span id="chat-class-display">Class: Loading...</span>
            </div>
            <div class="messages-area" id="messages-area">
                <div id="loading-indicator" class="loading-message">Loading chat...</div>
            </div>
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Type your message...">
                <button id="send-button">Send</button>
            </div>
            <div id="username-class-input-area">
                <input type="text" id="username-input" placeholder="Your Username (e.g., JohnD)">
                <input type="text" id="class-input" placeholder="Your Class (e.g., RCIA, 10th Grade)">
                <button id="save-profile-button">Save Profile</button>
            </div>
        </div>
    </section>
</div>

<!-- Custom Alert Modal and Overlay HTML (ensure these are at the end of body for z-index) -->
<div id="custom-alert-modal" class="hidden">
    <p class="alert-message"></p>
    <button class="alert-ok-button">OK</button>
</div>
<div id="alert-overlay" class="hidden"></div>

<footer>
    <button id="quit-nav-button">Quit</button>
</footer>

<script type="module" defer>
    // Import Firebase functions directly for use in this script block
    import { doc, getDoc, setDoc, collection, query, orderBy, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Global Variables (now also including Firebase instances) ---
    const splashScreen = document.getElementById('splash-screen');
    const mainContentContainer = document.querySelector('.main-content-container');
    const homeNavButton = document.getElementById('home-nav-button');
    const lessonsNavButton = document.getElementById('lessons-nav-button');
    const spiritualNavButton = document.getElementById('spiritual-nav-button');
    const chatMenuButton = document.getElementById('chat-menu-button'); // This correctly references the chat button
    const resourcesNavButton = document.getElementById('resources-nav-button');
    const quitNavButton = document.getElementById('quit-nav-button');

    // Updated lesson section variables
    const lessonsListSection = document.getElementById('lessons-list-section');
    const lessonsCategoryTitle = document.getElementById('lessons-category-title');
    const lessonsCategoryList = document.getElementById('lessons-category-list');
    const lessonsList = document.getElementById('lessons-list');
    const lessonContentSection = document.getElementById('lesson-content-section');
    const currentLessonTitle = document.getElementById('current-lesson-title');
    const currentLessonContent = document.getElementById('current-lesson-content');
    const lessonVideo = document.getElementById('lesson-video');
    const takeQuizButton = document.getElementById('take-quiz-button');
    const backToLessonsListButton = document.getElementById('back-to-lessons-list-button');
    const backToCategoriesButton = document.getElementById('back-to-categories-button');

    const quizSection = document.getElementById('quiz-section');
    const quizTitle = document.getElementById('quiz-title');
    const quizQuestionsContainer = document.getElementById('quiz-questions-container');
    const submitQuizButton = document.getElementById('submit-quiz-button');
    const backToLessonFromQuizButton = document.getElementById('back-to-lesson-from-quiz-button');

    // Chat elements (now correctly referencing elements within the single #chat-section)
    const messagesArea = document.getElementById('messages-area');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const usernameInput = document.getElementById('username-input');
    const classInput = document.getElementById('class-input');
    const saveProfileButton = document.getElementById('save-profile-button');
    const chatUserIdDisplay = document.getElementById('chat-user-id');
    const chatUsernameDisplay = document.getElementById('chat-username-display');
    const chatClassDisplay = document.getElementById('chat-class-display');
    const loadingIndicator = document.getElementById('loading-indicator'); // For chat loading

    // Custom Alert Modal elements
    const customAlertModal = document.getElementById('custom-alert-modal');
    const alertMessageElement = customAlertModal.querySelector('.alert-message');
    const alertOkButton = customAlertModal.querySelector('.alert-ok-button');
    const alertOverlay = document.getElementById('alert-overlay');

    // Rosary elements
    let rosaryStates = {}; // Centralized state for each mystery type

    // Prayers section elements
    const prayersListContainer = document.getElementById('prayers-list');
    const prayerTextElement = document.getElementById('prayer-text');
    const backToPrayersListButton = document.getElementById('back-to-prayers-list-button');


    // --- Data (Fill with your actual content) ---
    const lessonsData = {
        "The Profession of Faith": [
            {
                id: 'lesson1',
                title: "Introduction to OCIA — Rites & Periods + Introduction to Prayer",
                content: `<p>The Order of Christian Initiation of Adults (OCIA) is the process for adults to enter the Catholic Church. It includes periods like Inquiry, Catechumenate, Purification and Enlightenment (Lent), and Mystagogy. Rites include Acceptance, Scrutinies, and Initiation at Easter Vigil. Introduction to Prayer: Prayer is conversation with God, essential for faith growth (Compendium CCC 535-586).</p>
<p>Key points from Compendium: All the faithful are called to Christian holiness through union with Christ and the sacraments.</p>
<p>Relevant Questions: 251-294, 428, 534-536</p>
<p>Excerpt: "Christian initiation is accomplished by means of the sacraments which establish the foundations of Christian life." (Q251)</p>
<div class="video-placeholder">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/3vuYCjfO_w4?si=QdqxR9_yz2tyZ98Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div><p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
                    {
                question: "What is prayer according to the Compendium of the Catechism of the Catholic Church?",
                options: ["Raising one's mind and heart to God", "A set of rituals", "Only vocal recitation"],
                correct: 0
            },
            {
                question: "Which of the following is NOT one of the traditional expressions of Christian prayer?",
                options: ["Contemplative", "Meditative", "Poetic", "Vocal"],
                correct: 2
            },
            {
                question: "What is the primary goal of the Order of Christian Initiation of Adults (OCIA)?",
                options: ["To study theology academically", "To prepare adults to receive the sacraments of initiation", "To become lay ministers"],
                correct: 1
            },
            {
                question: "When is the Rite of Election typically celebrated?",
                options: ["On Easter Sunday", "At the beginning of Lent", "On Pentecost"],
                correct: 1
            },
            {
                question: "What are the three major expressions of prayer in the Christian tradition?",
                options: ["Adoration, Confession, Petition", "Vocal, Meditative, Contemplative", "Praise, Worship, Thanksgiving"],
                correct: 1
            },
            {
                question: "Who is the model and teacher of prayer in the Gospels?",
                options: ["St. Paul", "The Apostles", "Jesus Christ"],
                correct: 2
            },
            {
                question: "What is the 'Our Father' often called in Christian prayer?",
                options: ["The Lord’s Prayer", "The Apostle’s Creed", "The Morning Offering"],
                correct: 0
            },
            {
                question: "Which part of the OCIA process is marked by deeper spiritual formation and catechesis?",
                options: ["Purification and Enlightenment", "Mystagogy", "Catechumenate"],
                correct: 2
            },
            {
                question: "According to the Catechism, prayer is a ___________ with God.",
                options: ["Monologue", "Conversation", "Contemplation"],
                correct: 1
            },
            {
                question: "What does the period of Mystagogy focus on?",
                options: ["Introducing catechumens to Scripture", "Post-baptismal catechesis and integration into the Church", "Learning about different religions"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson2',
                title: "Salvation History & The Kerygma",
                content: `<p>Salvation History is God's plan to save humanity from sin, unfolding through the Bible from Creation to Christ. The Kerygma is the proclamation: God created us for relationship, sin broke it, Jesus restores through death and resurrection, respond in faith (Compendium CCC 7-10, 50-67).</p>
<p>Key points from Compendium: All the Old Covenant prefigurations find their fulfillment in Jesus Christ.</p>
<p>Relevant Questions: 6-9, 79-80, 126, 436-437, 536-537</p>
<p>Excerpt: "The full and definitive stage of God’s revelation is accomplished in his Word made flesh, Jesus Christ." (Q9)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/IuQm6PxKW44?si=5JAv3NueBDtlDmDs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
                    {
                question: "What is the Kerygma?",
                options: ["The moral code of the Church", "The core proclamation of the Gospel", "The list of doctrines from the Council of Trent"],
                correct: 1
            },
            {
                question: "Which event marks the beginning of salvation history?",
                options: ["The Exodus", "The Fall of Adam and Eve", "The Creation of the world"],
                correct: 2
            },
            {
                question: "What is the climax of salvation history?",
                options: ["The giving of the Ten Commandments", "The birth of the Church", "The life, death, and resurrection of Jesus Christ"],
                correct: 2
            },
            {
                question: "What was the purpose of God’s covenants with Noah, Abraham, Moses, and David?",
                options: ["To increase the population", "To prepare humanity for the Messiah", "To abolish sin completely"],
                correct: 1
            },
            {
                question: "Which statement best summarizes the first proclamation of the Kerygma?",
                options: ["God loves you and has a plan for your life", "You must obey all the rules", "The Church is infallible"],
                correct: 0
            },
            {
                question: "What did humanity lose in the Fall (Genesis 3)?",
                options: ["Free will", "The knowledge of good and evil", "Original holiness and original justice"],
                correct: 2
            },
            {
                question: "Who fulfills all the promises of the Old Covenant?",
                options: ["Moses", "Jesus Christ", "King Solomon"],
                correct: 1
            },
            {
                question: "What does God reveal through salvation history?",
                options: ["The rules of society", "The process of evolution", "His loving plan to save humanity"],
                correct: 2
            },
            {
                question: "What must our response be to the Kerygma?",
                options: ["Be amazed and keep it private", "Repent, believe in the Gospel, and be baptized", "Discuss it philosophically"],
                correct: 1
            },
            {
                question: "Why is Pentecost important in the story of salvation?",
                options: ["It marks the end of the Old Testament", "It is when Jesus ascended", "It is the birth of the Church and the outpouring of the Holy Spirit"],
                correct: 2
            }
                ]
            },
            {
                id: 'lesson3',
                title: "Revelation — Scripture, Tradition",
                content: `<p>Divine Revelation is transmitted through Scripture and Tradition, both flowing from the same divine well-spring.</p>
<p>Key points from Compendium: Tradition and Sacred Scripture are bound closely together.</p>
<p>Relevant Questions: 11-17, 18-24, 430, 438</p>
<p>Excerpt: "Tradition and Sacred Scripture are bound closely together and communicate one with the other." (Q14)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/lCuyyYSMlxQ?si=ljzG4cY7d2kVjehG" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
                    {
                question: "What is Divine Revelation?",
                options: ["Human reasoning about God", "God’s free self-communication to humanity", "A collection of religious texts"],
                correct: 1
            },
            {
                question: "Through what two sources is Divine Revelation transmitted?",
                options: ["Scripture and reason", "Tradition and Church law", "Sacred Scripture and Sacred Tradition"],
                correct: 2
            },
            {
                question: "Who is the fullness and finality of God's Revelation?",
                options: ["Moses", "St. Paul", "Jesus Christ"],
                correct: 2
            },
            {
                question: "What is Sacred Scripture?",
                options: ["Church documents", "The inspired Word of God in written form", "Writings of the saints"],
                correct: 1
            },
            {
                question: "What is Sacred Tradition?",
                options: ["Optional Church practices", "The oral transmission of the Gospel and teachings of Christ", "New revelations from saints"],
                correct: 1
            },
            {
                question: "Who has the responsibility of interpreting the Word of God authentically?",
                options: ["All the baptized", "Theologians", "The Magisterium of the Church"],
                correct: 2
            },
            {
                question: "What is the Magisterium?",
                options: ["The teaching authority of the Church", "A book of canon law", "A council of laypeople"],
                correct: 0
            },
            {
                question: "How is the Bible inspired?",
                options: ["It contains poetic truths", "It was dictated by angels", "It was written by human authors under the guidance of the Holy Spirit"],
                correct: 2
            },
            {
                question: "Which statement best describes the relationship between Scripture and Tradition?",
                options: ["Tradition overrides Scripture", "They are two separate revelations", "They are closely connected and flow from the same divine wellspring"],
                correct: 2
            },
            {
                question: "Why is it important to read Scripture within the living Tradition of the Church?",
                options: ["So we can critique it objectively", "To gain historical knowledge only", "To understand it as God intended, in unity with the faith community"],
                correct: 2
            }
                ]
            },
            {
                id: 'lesson4',
                title: "The Creed",
                content: `<p>The Creed summarizes the Christian faith, professing belief in God, Jesus, the Holy Spirit, the Church, and eternal life.</p>
<p>Key points from Compendium: The Creed expresses our confident 'yes' to faith.</p>
<p>Relevant Questions: 194-217, 442</p>
<p>Excerpt: "The Hebrew word 'Amen'... expresses our confident and total 'yes' to what we professed in the Creed." (Q217)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/aBaiMWrX9v4?si=J8z6Z6a6jMHeja_R" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html#The%20Profession%20of%20the%20Christian%20Faith" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What is the purpose of the Creed in the life of a Christian?",
                options: ["To summarize the teachings of the Apostles", "To replace Scripture", "To serve as a personal mission statement"],
                correct: 0
            },
            {
                question: "Which Creed is most commonly recited at Sunday Mass?",
                options: ["Apostles’ Creed", "Nicene Creed", "Athanasian Creed"],
                correct: 1
            },
            {
                question: "What does the word 'creed' mean?",
                options: ["Law", "Worship", "I believe"],
                correct: 2
            },
            {
                question: "Which phrase in the Creed affirms belief in Jesus’ divinity?",
                options: ["Born of the Virgin Mary", "He suffered under Pontius Pilate", "True God from true God, begotten, not made"],
                correct: 2
            },
            {
                question: "What do we profess about the Church in the Nicene Creed?",
                options: ["It is democratic and diverse", "It is one, holy, catholic, and apostolic", "It is governed by the local community"],
                correct: 1
            },
            {
                question: "What is the significance of 'consubstantial with the Father'?",
                options: ["Jesus is similar to God", "Jesus is a prophet of the Father", "Jesus is of the same divine nature as the Father"],
                correct: 2
            },
            {
                question: "What do we mean when we profess belief in the 'resurrection of the body'?",
                options: ["That we will reincarnate", "That our souls will live forever without bodies", "That we will rise again bodily at the end of time"],
                correct: 2
            },
            {
                question: "What is affirmed by the phrase 'He will come again in glory to judge the living and the dead'?",
                options: ["The general resurrection", "The second coming of Christ and the final judgment", "The creation of heaven"],
                correct: 1
            },
            {
                question: "When did the Church formally define the Nicene Creed?",
                options: ["Council of Jerusalem", "Council of Nicaea (325) and Constantinople (381)", "Vatican II"],
                correct: 1
            },
            {
                question: "Why do catechumens learn the Creed before baptism?",
                options: ["To pass a test", "To know Church history", "To personally profess and accept the faith of the Church"],
                correct: 2
            }
                ]
            },
            {
                id: 'lesson5',
                title: "  God & the Blessed Trinity",
                content: `<p>God is one in three Persons: Father, Son, and Holy Spirit.</p>
<p>Key points from Compendium: Grace makes us participants in Trinitarian life.</p>
<p>Relevant Questions: 36-43, 423, 428</p>
<p>Excerpt: "That grace is the gratuitous gift that God gives us to make us participants in his trinitarian life." (Q423)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/opiqPLaOoO0?si=jqnYpIeTTf712rSS" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html#I%20Believe%20in%20God%20the%20Father" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What is the central mystery of the Christian faith?",
                options: ["The Incarnation", "The Trinity", "The Resurrection"],
                correct: 1
            },
            {
                question: "How many persons are there in one God?",
                options: ["One", "Two", "Three"],
                correct: 2
            },
            {
                question: "Who are the three Persons of the Holy Trinity?",
                options: ["Father, Son, and Spirit of Truth", "Jesus, Mary, and Joseph", "Father, Son, and Holy Spirit"],
                correct: 2
            },
            {
                question: "Which of the following best describes the relationship of the Persons of the Trinity?",
                options: ["Three separate gods", "Three modes of one God", "One God in three distinct but equal Persons"],
                correct: 2
            },
            {
                question: "Which Person of the Trinity became incarnate?",
                options: ["The Father", "The Son", "The Holy Spirit"],
                correct: 1
            },
            {
                question: "What does the term 'consubstantial' mean in reference to the Trinity?",
                options: ["They share similar attributes", "They are united in purpose", "They are of the same divine substance"],
                correct: 2
            },
            {
                question: "What role is traditionally attributed to the Holy Spirit in the life of the Church?",
                options: ["Redeemer", "Sanctifier", "Creator"],
                correct: 1
            },
            {
                question: "Which creed explicitly affirms the doctrine of the Trinity?",
                options: ["Apostles’ Creed", "Nicene Creed", "Athanasian Creed"],
                correct: 2
            },
            {
                question: "According to the Catechism, why did God reveal Himself as Trinity?",
                options: ["To explain divine logic", "To help us understand the Incarnation", "To draw us into communion with Himself"],
                correct: 2
            },
            {
                question: "What does it mean to say the Trinity is a 'communion of Persons'?",
                options: ["They communicate often", "They exist in perfect self-giving love and unity", "They rule the Church together"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson6',
                title: "Creation & Humanity",
                content: `<p>God created the world out of nothing, and humanity in His image and likeness.</p>
<p>Key points from Compendium: God created everything for His glory and our good.</p>
<p>Relevant Questions: 51-67</p>
<p>Excerpt: "God freely created the universe from nothing." (Q53)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/-dS_V_gXPvk?si=HTcGT07RN0k3xGFY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/ENG0015/__P19.HTM" target="_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What does the Church teach about the origin of the world?",
                options: ["It happened by random chance", "It was created by God out of nothing", "It has always existed"],
                correct: 1
            },
            {
                question: "What does it mean that humans are made in the 'image and likeness of God'?",
                options: ["They physically resemble God", "They share in God's reason, freedom, and capacity for love", "They are divine beings"],
                correct: 1
            },
            {
                question: "What is the soul?",
                options: ["The emotional part of a person", "A temporary life-force", "The spiritual, immortal part of a human being"],
                correct: 2
            },
            {
                question: "What is Original Sin?",
                options: ["The first murder in Scripture", "Adam and Eve’s disobedience to God", "The worship of false gods"],
                correct: 1
            },
            {
                question: "What were the consequences of Original Sin?",
                options: ["Loss of original holiness, suffering, and death", "Increased intelligence", "Becoming like angels"],
                correct: 0
            },
            {
                question: "What is the Church’s teaching on the unity of the human race?",
                options: ["Different races were created separately", "All people descend from one set of first parents", "Only some groups are chosen by God"],
                correct: 1
            },
            {
                question: "What role do humans have in creation?",
                options: ["To dominate and destroy it", "To ignore it and focus only on heaven", "To be stewards and caretakers of God's creation"],
                correct: 2
            },
            {
                question: "What is the purpose of human life according to the Church?",
                options: ["To seek pleasure and comfort", "To know, love, and serve God in this life and be happy with Him forever in the next", "To improve human evolution"],
                correct: 1
            },
            {
                question: "Why did God create humanity?",
                options: ["To entertain Him", "To fulfill a cosmic necessity", "Out of love, to share His divine life with us"],
                correct: 2
            }
                ]
            },
            {
                id: 'lesson12',
                title: "Angels",
                content: `<p>This lesson explores the nature and role of angels in Catholic teaching.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson13',
                title: "The Blessed Virgin Mary",
                content: `<p>This lesson covers the Church's teachings on the Blessed Virgin Mary.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson14',
                title: "The Communion of Saints",
                content: `<p>This lesson explains the Communion of Saints, which includes the faithful on earth, in purgatory, and in heaven.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson17',
                title: "The Existence of God",
                content: `<p>This lesson explores arguments and Catholic teachings regarding the existence of God.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson18',
                title: "The Four Last Things",
                content: `<p>This lesson covers the Four Last Things: Death, Judgment, Heaven, and Hell.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson19',
                title: "God the Father",
                content: `<p>This lesson delves into the Person of God the Father, the first Person of the Holy Trinity.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson20',
                title: "The Kingdom of God",
                content: `<p>This lesson explains the concept of the Kingdom of God as proclaimed and inaugurated by Jesus Christ.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson21',
                title: "The Mystical Body of Christ",
                content: `<p>This lesson explores the Church as the Mystical Body of Christ, with Christ as the head and believers as members.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson23',
                title: "Providence",
                content: `<p>This lesson covers God's divine providence, His loving care and governance over all creation.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson24',
                title: "The Second Coming of Christ",
                content: `<p>This lesson examines the Church's teaching on the Second Coming of Christ (Parousia).</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson25',
                title: "The Story of the People of God",
                content: `<p>This lesson traces the history of God's relationship with His people, from ancient Israel to the Church.</p>`,
                videoUrl: '',
                quiz: []
            }
        ],
        "Christian Mysteries": [
            {
                id: 'lesson7',
                title: "Jesus Christ, Incarnation & Public Ministry",
                content: `<p>Jesus is the Son of God made flesh, who taught, healed, and proclaimed the Kingdom during His public life.</p>
<p>Key points from Compendium: The Incarnation means the Son of God became man.</p>
<p>Relevant Questions: 85-100</p>
<p>Excerpt: "The word 'Incarnation' means that the Son of God assumed human nature." (Q86)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/xphsJLRF9v8?si=wJZ2g75m15Q-BJUi" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html#I%20Believe%20in%20Jesus%20Christ,%20the%20Only%20Son%20of%20God"_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What is the Incarnation?",
                options: ["God pretending to be human", "Jesus becoming an angel", "The Son of God becoming truly man while remaining truly God"],
                correct: 2
            },
            {
                question: "Who is Jesus Christ?",
                options: ["A great moral teacher", "True God and true man, the second Person of the Trinity", "A prophet only"],
                correct: 1
            },
            {
                question: "What event marks the beginning of Jesus' public ministry?",
                options: ["His birth in Bethlehem", "His baptism in the Jordan by John the Baptist", "The Sermon on the Mount"],
                correct: 1
            },
            {
                question: "What did Jesus proclaim during His public ministry?",
                options: ["A new legal code", "A political revolution", "The Kingdom of God"],
                correct: 2
            },
            {
                question: "What are the signs of the Kingdom of God in Jesus’ ministry?",
                options: ["Political power and wealth", "Miracles, healings, and forgiveness of sins", "Temple sacrifices"],
                correct: 1
            },
            {
                question: "Why did the Son of God become man?",
                options: ["To show off divine power", "To condemn sinners", "To save us by reconciling us with God and to reveal God’s love"],
                correct: 2
            },
            {
                question: "What do the miracles of Jesus demonstrate?",
                options: ["His magical powers", "His compassion and divine authority", "His rivalry with other teachers"],
                correct: 1
            },
            {
                question: "How did Jesus teach about the Kingdom of God?",
                options: ["Through commandments only", "Only in the synagogue", "Through parables, actions, and personal example"],
                correct: 2
            },
            {
                question: "What title did Jesus most often use to refer to Himself?",
                options: ["Messiah", "Son of God", "Son of Man"],
                correct: 2
            },
            {
                question: "What is the significance of the Transfiguration?",
                options: ["Jesus became invisible", "Jesus revealed His divine glory to Peter, James, and John", "Jesus taught His first parable"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson8',
                title: "The Paschal Mystery",
                content: `<p>The Paschal Mystery is Christ's passion, death, resurrection, and ascension.</p>
<p>Key points from Compendium: The Paschal Mystery is central to salvation.</p>
<p>Relevant Questions: 106-126</p>
<p>Excerpt: "The Paschal Mystery of Jesus... is the work of our redemption." (Q106)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/Psg7PokhH6c?si=3fOAlx4EZbrj2Igv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/ENG0015/__P1M.HTM"_blank">CCC</a></p>`,
                quiz: [
            {
                question: "What is the Paschal Mystery?",
                options: ["A puzzle in the Bible", "The life of Jesus as a teacher", "The Passion, Death, Resurrection, and Ascension of Jesus",
                ],
                correct: 2
            },
            {
                question: "Why did Jesus freely suffer and die on the Cross?",
                options: ["To prove His strength", "To defeat political enemies", "To save humanity from sin and death"],
                correct: 2
            },
            {
                question: "What is the significance of the Resurrection?",
                options: ["It shows Jesus escaped death temporarily", "It proves Jesus is divine and offers eternal life", "It symbolizes good triumphing over evil"],
                correct: 1
            },
            {
                question: "What event does the Church celebrate on Good Friday?",
                options: ["The Last Supper", "The Crucifixion and death of Jesus", "The Resurrection"],
                correct: 1
            },
            {
                question: "What happened at the Last Supper?",
                options: ["Jesus washed the Apostles' feet", "Jesus instituted the Eucharist and the priesthood", "Jesus wrote the Gospels"],
                correct: 1
            },
            {
                question: "What is the Ascension?",
                options: ["Jesus rising from the dead", "Jesus appearing in the tomb", "Jesus being taken up into Heaven in glory"],
                correct: 2
            },
            {
                question: "How does the Paschal Mystery relate to the sacraments?",
                options: ["It is only symbolized at Easter", "It is re-presented and made present in the sacraments, especially the Eucharist", "It is remembered only in prayer"],
                correct: 1
            },
            {
                question: "What is the significance of Jesus’ suffering being 'freely accepted'?",
                options: ["It fulfilled an ancient prophecy", "It shows that love requires suffering", "It reveals God's perfect love and obedience"],
                correct: 2
            },
            {
                question: "When is the Paschal Mystery most fully celebrated in the Church year?",
                options: ["Advent", "Lent", "The Easter Triduum"],
                correct: 2
            },
            {
                question: "What do Christians hope for through participation in the Paschal Mystery?",
                options: ["Material blessings", "Political success", "Eternal life with God"],
                correct: 2
            }
                ]
            },
            {
                id: 'lesson9',
                title: "Holy Spirit & The Church",
                content: `<p>The Holy Spirit animates the Church, which is the Body of Christ.</p>
<p>Key points from Compendium: At Pentecost, the Holy Spirit descended on the apostles.</p>
<p>Relevant Questions: 127-184</p>
<p>Excerpt: "What happened at Pentecost? The Holy Spirit descended upon the Apostles." (Q144)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/gc9cQdiU9Fs?si=XnyGr4vHMl2bo-1J" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html#I%20Believe%20in%20the%20Holy%20Spirit"_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "Who is the Holy Spirit?",
                options: ["A force of nature", "The third Person of the Holy Trinity", "An angel sent from heaven"],
                correct: 1
            },
            {
                question: "When was the Holy Spirit sent to the Church in a special way?",
                options: ["On Holy Thursday", "At the Ascension", "At Pentecost"],
                correct: 2
            },
            {
                question: "What are the symbols of the Holy Spirit used in Scripture?",
                options: ["Dove, wind, fire", "Water, sword, lightning", "Star, cloud, eagle"],
                correct: 0
            },
            {
                question: "What is the role of the Holy Spirit in the Church?",
                options: ["To replace Jesus", "To animate and guide the Church", "To create laws for the Church"],
                correct: 1
            },
            {
                question: "What is the Church?",
                options: ["A human organization", "A community of people who like Jesus", "The People of God, the Body of Christ, and Temple of the Holy Spirit"],
                correct: 2
            },
            {
                question: "What happened at Pentecost?",
                options: ["Jesus rose from the dead", "The Apostles received the Holy Spirit and began preaching boldly", "The disciples fled from Jerusalem"],
                correct: 1
            },
            {
                question: "What is the mission of the Church?",
                options: ["To preserve ancient traditions", "To entertain the faithful", "To proclaim the Gospel and make disciples of all nations"],
                correct: 2
            },
            {
                question: "Who is the visible head of the Church on earth?",
                options: ["The Holy Spirit", "The Pope", "The Bible"],
                correct: 1
            },
            {
                question: "How is the Church one, holy, catholic, and apostolic?",
                options: ["By its ancient buildings", "By its legal system", "Through its unity, sanctity, universality, and apostolic foundation"],
                correct: 2
            },
            {
                question: "Why is apostolic succession important?",
                options: ["It gives the Church historical credibility", "It ensures continuity of teaching and sacramental authority from the Apostles", "It proves the Church is old"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson10',
                title: "Four Marks of the Church",
                content: `<p>The Church is one, holy, catholic, and apostolic.</p>
<p>Key points from Compendium: These marks characterize the true Church.</p>
<p>Relevant Questions: 161-171</p>
<p>Excerpt: "The Church is one, holy, catholic, and apostolic." (Q161)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/ObkAsmTwCpI?si=IZYWCWmqWriLNUIR" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/compendium_ccc/documents/archive_2005_compendium-ccc_en.html#I%20Believe%20in%20the%20Holy%20Spirit"_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What are the Four Marks of the Church as stated in the Nicene Creed?",
                options: ["One, Universal, Apostolic, Christian", "Holy, Catholic, Apostolic, Global", "One, Holy, Catholic, and Apostolic"],
                correct: 2
            },
            {
                question: "What does it mean that the Church is 'One'?",
                options: ["There is one church building in every town", "It is united in faith, worship, and leadership", "It only speaks one language"],
                correct: 1
            },
            {
                question: "Why is the Church called 'Holy'?",
                options: ["Because all its members are perfect", "Because it was founded by Christ and filled with the Holy Spirit", "Because it has ancient customs"],
                correct: 1
            },
            {
                question: "What does 'Catholic' mean in the Four Marks?",
                options: ["Roman", "Universal — for all people, in all times, in all places", "Hierarchical"],
                correct: 1
            },
            {
                question: "What does it mean that the Church is 'Apostolic'?",
                options: ["It follows the teachings of Church councils", "It is led by bishops who succeed the Apostles", "It uses ancient apostolic languages"],
                correct: 1
            },
            {
                question: "How does the Church preserve its unity?",
                options: ["Through Scripture alone", "Through the Pope and bishops in communion with him", "By limiting diversity"],
                correct: 1
            },
            {
                question: "How does the Church remain holy despite the sinfulness of its members?",
                options: ["By removing all sinners", "Because holiness comes from Christ and the sacraments", "Through public penance only"],
                correct: 1
            },
            {
                question: "What role do the sacraments play in the holiness of the Church?",
                options: ["They are optional rites", "They are social celebrations", "They are means of grace that sanctify the faithful"],
                correct: 2
            },
            {
                question: "How is the Church's catholicity expressed?",
                options: ["By being centered in Rome", "By embracing all cultures and proclaiming the fullness of truth to all", "By maintaining Latin as its official language"],
                correct: 1
            },
            {
                question: "Why is apostolic succession important?",
                options: ["It gives the Church historical credibility", "It ensures continuity of teaching and sacramental authority from the Apostles", "It proves the Church is old"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson27',
                title: "Anointing of the Sick and Redemptive Suffering",
                content: `<p>This lesson covers the Sacrament of Anointing of the Sick and the Catholic understanding of redemptive suffering.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson28',
                title: "Baptism",
                content: `<p>This lesson explains the Sacrament of Baptism, its effects, and its significance for Christian life.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson29',
                title: "Confirmation",
                content: `<p>This lesson focuses on the Sacrament of Confirmation, the outpouring of the Holy Spirit, and strengthening for mission.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson30',
                title: "The Eucharist (Lesson 1 of 2)",
                content: `<p>This is the first part of a two-part lesson on the Sacrament of the Eucharist, the source and summit of Christian life.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson31',
                title: "The Eucharist (Lesson 2 of 2)",
                content: `<p>This is the second part of a two-part lesson on the Sacrament of the Eucharist, continuing the exploration of its meaning and effects.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson32',
                title: "Holy Orders",
                content: `<p>This lesson covers the Sacrament of Holy Orders, through which bishops, priests, and deacons are ordained.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson33',
                title: "Liturgy",
                content: `<p>This lesson introduces the concept of liturgy as the public worship of the Church.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson34',
                title: "The Mass",
                content: `<p>This lesson provides an overview of the Holy Mass, its structure, and its significance.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson35',
                title: "Matrimony",
                content: `<p>This lesson explores the Sacrament of Matrimony, its nature, and its purposes.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson36',
                title: "Reconciliation",
                content: `<p>This lesson focuses on the Sacrament of Reconciliation (Confession), God's mercy, and forgiveness of sins.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson37',
                title: "The Sacramental Economy",
                content: `<p>This lesson explains the sacramental economy, how God's grace is communicated through the Sacraments.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson38',
                title: "Sacramental Living",
                content: `<p>This lesson discusses how Christians live out their faith through active participation in the Sacraments.</p>`,
                videoUrl: '',
                quiz: []
            }
        ],
        "Life in Christ": [
            {
                id: 'lesson11',
                title: "Christ’s Faithful – Hierarchy, Laity, Consecrated",
                content: `<p>The faithful include the hierarchy (bishops, priests), laity, and consecrated life.</p>
<p>Key points from Compendium: The bishops proclaim the Gospel authoritatively.</p>
<p>Relevant Questions: 172-184</p>
<p>Excerpt: "The bishops in union with the Pope have the duty of proclaiming the Gospel." (Q184)</p>
<div class="video-placeholder"><iframe width="560" height="315" src="https://www.youtube.com/embed/0I9fwEsNClM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<p>Online resource: <a href="https://www.vatican.va/archive/ENG0015/__P1M.HTM"_blank">Compendium of the CCC</a></p>`,
                quiz: [
            {
                question: "What are the three categories of Christ's faithful?",
                options: ["Priests, deacons, and bishops", "Hierarchy, laity, and consecrated life", "Men, women, and children"],
                correct: 1
            },
            {
                question: "Who constitutes the hierarchy of the Church?",
                options: ["Only the Pope", "Bishops, priests, and deacons", "All baptized Catholics"],
                correct: 1
            },
            {
                question: "What is the primary role of the laity in the Church?",
                options: ["To serve as priests", "To evangelize and sanctify the world through their daily lives", "To govern the Church"],
                correct: 1
            },
            {
                question: "What is the consecrated life?",
                options: ["Marriage", "A state of life recognized by the Church, where individuals dedicate themselves to God through vows", "A temporary commitment to prayer"],
                correct: 1
            },
            {
                question: "Who is the successor of St. Peter and the visible head of the Church?",
                options: ["The local bishop", "The Pope", "A council of cardinals"],
                correct: 1
            },
            {
                question: "What is the 'common priesthood of the faithful'?",
                options: ["All men are called to be priests", "Participation of all baptized in Christ's priestly mission through prayer and sacrifice", "Only those ordained can pray"],
                correct: 1
            },
            {
                question: "What is the 'ministerial priesthood'?",
                options: ["The priesthood of all believers", "The ordained ministry of bishops and priests", "The role of deacons only"],
                correct: 1
            },
            {
                question: "How do members of the consecrated life live out their dedication to God?",
                options: ["By living in solitude", "Through vows of poverty, chastity, and obedience", "By accumulating wealth for the Church"],
                correct: 1
            },
            {
                question: "What is the role of deacons?",
                options: ["To offer the sacrifice of the Mass", "To assist bishops and priests in ministry, especially in service and charity", "To govern dioceses"],
                correct: 1
            },
            {
                question: "How do the different states of life (hierarchy, laity, consecrated) work together in the Church?",
                options: ["They compete for power", "They each have distinct roles that contribute to the Church's mission", "They operate independently"],
                correct: 1
            }
                ]
            },
            {
                id: 'lesson15',
                title: "The Dignity of the Human Person",
                content: `<p>This lesson focuses on the inherent dignity of every human person, created in the image and likeness of God.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson16',
                title: "Ecumenism and Other Religions",
                content: `<p>This lesson discusses the Church's approach to ecumenism (unity among Christians) and its relationship with other religions.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson22',
                title: "The Priesthood of the Faithful and Evangelization",
                content: `<p>This lesson discusses the common priesthood of all baptized faithful and their call to evangelization.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson26',
                title: "Temptation and Sin",
                content: `<p>This lesson explores the nature of temptation and sin, and the path to repentance and forgiveness.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson39',
                title: "Cardinal Virtues and the Virtues of Chastity and Humility",
                content: `<p>This lesson covers the Cardinal Virtues (Prudence, Justice, Fortitude, Temperance) and the importance of chastity and humility.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson40',
                title: "The First Three Commandments",
                content: `<p>This lesson provides an in-depth look at the first three of the Ten Commandments, focusing on our relationship with God.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson41',
                title: "Freedom in Christ",
                content: `<p>This lesson explores the concept of Christian freedom, which is freedom from sin and for service to God and others.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson42',
                title: "Grace",
                content: `<p>This lesson explains the nature and types of grace as God's free gift to us.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson43',
                title: "Justification and Merit",
                content: `<p>This lesson covers the theological concepts of justification (being made righteous by God) and merit (our cooperation with grace).</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson44',
                title: "The Last Seven Commandments",
                content: `<p>This lesson provides an in-depth look at the last seven of the Ten Commandments, focusing on our relationship with our neighbor.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson45',
                title: "Mercy and Justice",
                content: `<p>This lesson discusses the balance of God's mercy and justice in Catholic teaching.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson46',
                title: "Natural Law",
                content: `<p>This lesson explains Natural Law as the moral order discoverable by human reason.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson47',
                title: "The Social Teachings of the Church",
                content: `<p>This lesson introduces the key principles of Catholic Social Teaching, addressing societal issues from a faith perspective.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson48',
                title: "The Two Great Commandments (The New Law)",
                content: `<p>This lesson focuses on Jesus' teaching of the Two Great Commandments: love of God and love of neighbor.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson49',
                title: "The Universal Call to Holiness",
                content: `<p>This lesson emphasizes that all Christians are called to holiness, regardless of their state in life.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson50',
                title: "The Virtue of Faith",
                content: `<p>This lesson explores the theological virtue of faith, believing in God and all that He has revealed.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson51',
                title: "The Virtue of Hope",
                content: `<p>This lesson focuses on the theological virtue of hope, trusting in God's promises and eternal life.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson52',
                title: "The Virtue of Love",
                content: `<p>This lesson delves into the theological virtue of love (charity), loving God above all and our neighbor as ourselves.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson53',
                title: "Vocations: God's Call",
                content: `<p>This lesson discusses the various vocations within the Church, as God's call to each individual.</p>`,
                videoUrl: '',
                quiz: []
            }
        ],
        "Christian Prayer": [
            {
                id: 'lesson54',
                title: "The Battle of Prayer",
                content: `<p>This lesson explores the challenges and perseverance required in the life of prayer.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson55',
                title: "Liturgical Prayer",
                content: `<p>This lesson focuses on prayer within the liturgy of the Church, particularly the Mass and Liturgy of the Hours.</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson56',
                title: "The Lord's Prayer",
                content: `<p>This lesson provides a detailed explanation and reflection on the Our Father (The Lord's Prayer).</p>`,
                videoUrl: '',
                quiz: []
            },
            {
                id: 'lesson57',
                title: "Traditions of Prayer",
                content: `<p>This lesson introduces various traditions and forms of prayer within the Catholic Church.</p>`,
                videoUrl: '',
                quiz: []
            }
        ]
    };

    // Flattened list of all lessons for progress tracking (order matters!)
    const allLessonsFlat = Object.values(lessonsData).flat();

    const prayersData = {
        "Sign of the Cross": "In the name of the Father, and of the Son, and of the Holy Spirit. Amen.",
        "Our Father": "Our Father, Who art in Heaven, hallowed be Thy Name. Thy Kingdom come, Thy Will be done, on earth as it is in Heaven. Give us this day our daily bread, and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen.",
        "Hail Mary": "Hail Mary, full of grace, the Lord is with thee. Blessed art thou among women, and and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen.",
        "Glory Be": "Glory be to the Father, and to the Son, and to the Holy Spirit. As it was in the beginning, is now, and ever shall be, world without end. Amen.",
        "Apostles' Creed": "I believe in God, the Father Almighty, Creator of Heaven and earth; and in Jesus Christ, His only Son, Our Lord; Who was conceived by the Holy Spirit, born of the Virgin Mary, suffered under Pontius Pilate, was crucified, died, and was buried. He descended into Hell; the third day He arose again from the dead; He ascended into Heaven, and sitteth at the right hand of God, the Father Almighty; from thence He shall come to judge the living and the dead. I believe in the Holy Spirit, the Holy Catholic Church, the communion of Saints, the forgiveness of sins, the resurrection of the body, and life everlasting. Amen.",
        "Nicene Creed": "I believe in one God, the Father almighty, maker of heaven and earth, of all things visible and invisible. I believe in one Lord Jesus Christ, the Only Begotten Son of God, born of the Father before all ages. God from God, Light from Light, true God from true God, begotten, not made, consubstantial with the Father; through him all things were made. For us men and for our salvation he came down from heaven, and by the Holy Spirit was incarnate of the Virgin Mary, and became man. For our sake he was crucified under Pontius Pilate, he suffered death and was buried, and rose again on the third day in accordance with the Scriptures. He ascended into heaven and is seated at the right hand of the Father. He will come again in glory to judge the living and the dead and his kingdom will have no end. I believe in the Holy Spirit, the Lord, the giver of life, who proceeds from the Father and the Son, who with the Father and the Son is adored and glorified, who has spoken through the prophets. I believe in one, holy, catholic and apostolic Church. I confess one Baptism for the forgiveness of sins and I look forward to the resurrection of the dead and the life of the world to come. Amen.",
        "Act of Contrition": "O my God, I am heartily sorry for having offended Thee, and I detest all my sins because of Thy just punishments, but most of all because they offend Thee, my God, Who art all good and deserving of all my love. I firmly resolve, with the help of Thy grace, to sin no more and to avoid the near occasions of sin. Amen.",
        "Hail Holy Queen": "Hail, Holy Queen, Mother of Mercy, our life, our sweetness, and our hope. To thee do we cry, poor banished children of Eve; to thee do we send up our sighs, mourning and weeping in this valley of tears. Turn then, most gracious Advocate, thine eyes of mercy toward us, and after this our exile, show unto us the blessed Fruit of thy womb, Jesus. O clement, O loving, O sweet Virgin Mary. Pray for us, O Holy Mother of God, that we may be made worthy of the promises of Christ. Amen.",
        "Memorare": "Remember, O most gracious Virgin Mary, that never was it known that anyone who fled to thy protection, implored thy help, or sought thy intercession was left unaided. Inspired by this confidence, I fly unto thee, O Virgin of virgins, my Mother. To thee do I come, before thee I stand, sinful and sorrowful. O Mother of the Word Incarnate, despise not my petitions, but in thy mercy hear and answer me. Amen.",
        "Angelus": "The Angel of the Lord declared unto Mary. And she conceived of the Holy Spirit.\n\nHail Mary...\n\nBehold the handmaid of the Lord. Be it done unto me according to Thy Word.\n\nHail Mary...\n\nAnd the Word was made Flesh. And dwelt among us.\n\nHail Mary...\n\nPray for us, O Holy Mother of God. That we may be made worthy of the promises of Christ.\n\nLet us pray. Pour forth, we beseech Thee, O Lord, Thy grace into our hearts; that we, to whom the Incarnation of Christ, Thy Son, was made known by the message of an Angel, may by His Passion and Cross be brought to the glory of His Resurrection. Through the same Christ Our Lord. Amen.",
        "Prayer to St. Michael": "Saint Michael the Archangel, defend us in battle. Be our protection against the wickedness and snares of the Devil. May God rebuke him, we humbly pray; and do thou, O Prince of the Heavenly Host, by the power of God, cast into hell Satan, and all the evil spirits, who prowl about the world seeking the ruin of souls. Amen.",
        "Anima Christi": "Soul of Christ, sanctify me. Body of Christ, save me. Blood of Christ, inebriate me. Water from the side of Christ, wash me. Passion of Christ, strengthen me. O good Jesus, hear me. Within Thy wounds hide me. Permit me not to be separated from Thee. From the wicked foe defend me. At the hour of my death call me. And bid me come to Thee, that with Thy Saints I may praise Thee. Forever and ever. Amen.",
        "Guardian Angel Prayer": "Angel of God, my guardian dear, to whom God's love commits me here, ever this day be at my side, to light and guard, to rule and guide. Amen.",
        "Grace Before Meals": "Bless us, O Lord, and these thy gifts, which we are about to receive from thy bounty, through Christ our Lord. Amen.",
        "Grace After Meals": "We give Thee thanks for all Thy benefits, O Almighty God, Who livest and reignest forever and ever. Amen. May the souls of the faithful departed, through the mercy of God, rest in peace. Amen.",
        "Morning Offering": "O Jesus, through the Immaculate Heart of Mary, I offer You my prayers, works, joys, and sufferings of this day for all the intentions of Your Sacred Heart, in union with the Holy Sacrifice of the Mass throughout the world, in reparation for my sins, for the intentions of all our associates, and for the conversion of sinners. Amen.",
        "Act of Faith": "O my God, I firmly believe that you are one God in three divine Persons, Father, Son, and Holy Spirit. I believe that your divine Son became man and died for our sins, and that he will come to judge the living and the dead. I believe these and all the truths which the holy Catholic Church teaches, because you have revealed them, who can neither deceive nor be deceived. Amen.",
        "Act of Hope": "O my God, relying on your almighty help and promises, I hope to gain eternal life and the graces necessary to obtain it, because you are all-good and merciful. Amen.",
        "Act of Love": "O my God, I love you above all things, with my whole heart and soul, because you are all-good and worthy of all my love. I love my neighbor as myself for love of you. I forgive all who have injured me and ask pardon of all whom I have injured. Amen.",
        "Fatima Prayer": "O my Jesus, forgive us our sins, save us from the fires of hell, lead all souls to Heaven, especially those in most need of Thy mercy. Amen.",
        "Come Holy Spirit": "Come, Holy Spirit, fill the hearts of Thy faithful and enkindle in them the fire of Thy love. Send forth Thy Spirit and they shall be created. And Thou shalt renew the face of the earth. O, God, Who by the light of the Holy Spirit, didst instruct the hearts of the faithful, grant that by the same Holy Spirit we may be truly wise and ever enjoy His consolations, Through Christ Our Lord. Amen.",
        "Eternal Rest": "Eternal rest grant unto them, O Lord, and let perpetual light shine upon them. May the souls of the faithful departed, through the mercy of God, rest in peace. Amen.",
        "Divine Praises": "Blessed be God.\nBlessed be His Holy Name.\nBlessed be Jesus Christ, true God and true Man.\nBlessed be the Name of Jesus.\nBlessed be His Most Sacred Heart.\nBlessed be His Most Precious Blood.\nBlessed be Jesus in the Most Holy Sacrament of the Altar.\nBlessed be the Holy Spirit, the Paraclete.\nBlessed be the great Mother of God, Mary Most Holy.\nBlessed be her Holy and Immaculate Conception.\nBlessed be her Glorious Assumption.\nBlessed be the Name of Mary, Virgin and Mother.\nBlessed be St. Joseph, her most chaste spouse.\nBlessed be God in His Angels and and in His Saints. Amen.",
        "Confiteor": "I confess to almighty God and to you, my brothers and sisters, that I have greatly sinned, in my thoughts and in my words, in what I have done and in what I have failed to do, through my fault, through my fault, through my most grievous fault; therefore I ask blessed Mary ever-Virgin, all the Angels and Saints, and you, my brothers and sisters, to pray for me to the Lord our God. Amen."
    };

    // Mysteries with scripture (Added placeholder scripture content)
    const joyfulMysteries = [
        {name: "The Annunciation", scripture: "Luke 1:26-38\n\nThe Angel Gabriel announces to Mary that she will conceive by the Holy Spirit and bear a son, Jesus."},
        {name: "The Visitation", scripture: "Luke 1:39-56\n\nMary visits her cousin Elizabeth, who is also pregnant, and John the Baptist leaps in her womb."},
        {name: "The Nativity", scripture: "Luke 2:1-20\n\nJesus is born in Bethlehem and laid in a manger, as angels proclaim His birth to shepherds."},
        {name: "The Presentation", scripture: "Luke 2:22-38\n\nMary and Joseph present Jesus in the Temple, where Simeon and Anna prophesy about Him."},
        {name: "The Finding in the Temple", scripture: "Luke 2:41-52\n\nJesus, at age twelve, is found in the Temple, astounding teachers with His wisdom."}
    ];

    const sorrowfulMysteries = [
        {name: "The Agony in the Garden", scripture: "Luke 22:39-46\n\nJesus prays in Gethsemane, sweating blood as He contemplates His Passion."},
        {name: "The Scourging at the Pillar", scripture: "John 19:1\n\nPilate has Jesus scourged severely, hoping to appease the crowd."},
        {name: "The Crowning with Thorns", scripture: "Matthew 27:27-31\n\nSoldiers mock Jesus, placing a crown of thorns on His head and hailing Him as 'King of the Jews'."},
        {name: "The Carrying of the Cross", scripture: "John 19:16-17\n\nJesus carries His heavy cross through Jerusalem, stumbling along the way."},
        {name: "The Crucifixion", scripture: "John 19:18-30\n\nJesus is nailed to the cross and dies, offering salvation to humanity."}
    ];

    const gloriousMysteries = [
        {name: "The Resurrection", scripture: "Matthew 28:1-10\n\nJesus rises from the dead on the third day, appearing to His disciples."},
        {name: "The Ascension", scripture: "Acts 1:6-11\n\nJesus ascends into Heaven forty days after His Resurrection, promising the Holy Spirit."},
        {name: "The Descent of the Holy Spirit", scripture: "Acts 2:1-11\n\nThe Holy Spirit descends upon the apostles and Mary at Pentecost, empowering them to preach."},
        {name: "The Assumption", scripture: "Luke 1:46-55\n\nMary is taken body and soul into heavenly glory at the end of her earthly life."},
        {name: "The Coronation of Mary", scripture: "Revelation 12:1\n\nMary is crowned Queen of Heaven and Earth by her Son, Jesus Christ."}
    ];

    const luminousMysteries = [
        {name: "The Baptism of Christ in the Jordan", scripture: "Matthew 3:13-17\n\nJesus is baptized by John the Baptist, and the Holy Spirit descends upon Him."},
        {name: "The Wedding Feast at Cana", scripture: "John 2:1-11\n\nAt Mary's request, Jesus performs His first public miracle, turning water into wine."},
        {name: "Jesus' Proclamation of the Kingdom of God", scripture: "Mark 1:14-15\n\nJesus begins His public ministry, proclaiming the good news of the Kingdom of God and calling for repentance."},
        {name: "The Transfiguration", scripture: "Matthew 17:1-8\n\nJesus is transfigured before Peter, James, and John, revealing His divine glory."},
        {name: "The Institution of the Eucharist", scripture: "Luke 22:14-20\n\nAt the Last Supper, Jesus institutes the Eucharist, giving His Body and Blood as spiritual food."}
    ];


    // --- Custom Alert Modal Functions (defined ONCE globally) ---
    function showAlert(message, callback = null) {
        alertMessageElement.textContent = message;
        customAlertModal.classList.remove('hidden');
        alertOverlay.classList.add('active'); // Use 'active' for overlay display
        customAlertModal._alertCallback = callback; // Store the callback
    }

    if (alertOkButton) {
        alertOkButton.addEventListener('click', () => {
            customAlertModal.classList.add('fade-out'); // Start fade-out animation

            // Immediately hide the modal and overlay after starting fade-out,
            // then clean up animation class after animationend.
            // This makes it more robust if animationend is missed.
            customAlertModal.classList.add('hidden'); // Hide the modal immediately
            alertOverlay.classList.remove('active'); // Deactivate the alert overlay

            function handleAnimationEnd() {
                customAlertModal.classList.remove('fade-out'); // Remove fade-out class
                // Call the stored callback if it exists
                if (customAlertModal._alertCallback) {
                    customAlertModal._alertCallback();
                    customAlertModal._alertCallback = null; // Clear callback
                }
                customAlertModal.removeEventListener('animationend', handleAnimationEnd); // Remove itself
            }

            // Listen for the 'animationend' event on the modal itself
            customAlertModal.addEventListener('animationend', handleAnimationEnd, { once: true }); // Ensure it runs only once
        });
    }

    // Optional: Close modal if overlay is clicked
    if (alertOverlay) {
        alertOverlay.addEventListener('click', () => {
            // Only allow closing by clicking overlay if the modal itself isn't in a transition
            if (!customAlertModal.classList.contains('fade-out')) {
                customAlertModal.classList.add('hidden');
                alertOverlay.classList.remove('active');
                // Decide if clicking overlay should trigger the callback
                if (customAlertModal._alertCallback) {
                    customAlertModal._alertCallback();
                    customAlertModal._alertCallback = null;
                }
            }
        });
    }


    // --- Section Management ---
    let currentActiveSection = null;
    let currentCategory = null; // Tracks the currently selected lesson category

    function showSection(sectionId) {
        const sections = document.querySelectorAll('.main-content-container section');
        let targetSection = document.getElementById(sectionId);

        if (!targetSection) {
            console.error(`Section with ID "${sectionId}" not found.`);
            showAlert(`Error: Section "${sectionId}" not found.`);
            return;
        }

        // 1. Hide ALL sections immediately by setting display to 'none'
        sections.forEach(section => {
            section.style.display = 'none';
            section.classList.add('hidden'); // Ensure hidden class is present for fade-in later
            section.classList.remove('active');
        });

        // 2. Determine display type for the target section and show it
        let displayType = 'block';
        if (sectionId === 'chat-section') {
            displayType = 'flex'; // Chat section needs flex for its internal layout
        } else if (sectionId === 'prayers-section') {
            displayType = 'block'; // prayers-section itself is block, its content is flex
        }
        
        targetSection.style.display = displayType; // Make it display immediately

        // Use requestAnimationFrame to ensure the display change is rendered
        // before the opacity transition is triggered.
        requestAnimationFrame(() => {
            targetSection.classList.remove('hidden'); // Remove hidden to trigger fade-in
            targetSection.classList.add('active'); // Add active class
        });
        currentActiveSection = targetSection; // Update current active section

        // Special handling for specific sections that might need internal elements adjusted
        if (sectionId === 'lessons-list-section') {
            renderLessonsList(); // Ensure the list is rendered/updated
        }
        // Specific prayer list display needs to be handled though.
        if (sectionId === 'prayers-section') {
            document.getElementById('prayers-list').classList.remove('hidden');
            document.getElementById('prayers-list').style.display = 'flex'; 
            prayerTextElement.classList.add('hidden');
            prayerTextElement.style.display = 'none'; 
            backToPrayersListButton.classList.add('hidden');
            backToPrayersListButton.style.display = 'none'; 
        }
    }


    // --- Splash Screen Logic ---
    window.addEventListener('load', () => {
        // Initial state: hide main content
        if (mainContentContainer) {
            mainContentContainer.style.display = 'none'; // Ensure it's not visible initially
            mainContentContainer.classList.remove('visible');
        }

        // Trigger fade-out after banner animation duration (4s, as per @keyframes bannerIntroAnimation)
        setTimeout(() => {
            splashScreen.classList.add('fade-out');

            // Wait for splash screen fade-out transition to finish (1s CSS transition), then show main content
            splashScreen.addEventListener('transitionend', (e) => {
                if (e.propertyName === 'opacity' && splashScreen.classList.contains('fade-out')) {
                    splashScreen.style.display = 'none'; // Fully hide splash screen
                    if (mainContentContainer) {
                        mainContentContainer.style.display = 'flex'; // Or 'block', based on desired layout
                        // Use requestAnimationFrame to ensure CSS transition is applied after display change
                        requestAnimationFrame(() => {
                            mainContentContainer.classList.add('visible'); // Triggers opacity transition
                        });
                        showSection('main-menu-section'); // Show the initial section
                    }
                }
            }, { once: true }); // Ensure this listener only runs once
        }, 4000); // Match total splash animation time (bannerIntroAnimation duration)
    });


    // --- Lessons & Quizzes Functions ---
    let currentLesson = null; // Stores the currently viewed lesson object
    let currentQuiz = null; // Stores the quiz data for the current lesson
    let unlockedLessonIndex = 0; // Default to 0, will be loaded from Firestore

    // Progress tracking functions using Firestore
    async function loadLessonProgress() {
        if (!window.db || !window.currentUserId) {
            console.warn("Firestore not initialized or user not authenticated. Cannot load lesson progress.");
            return;
        }
        try {
            const progressDocRef = doc(window.db, `artifacts/${window.appId}/users/${window.currentUserId}/progress/lesson_progress`);
            const progressSnap = await getDoc(progressDocRef);
            if (progressSnap.exists()) {
                unlockedLessonIndex = progressSnap.data().unlockedLessonIndex || 0;
            } else {
                // If no progress document, create one with initial progress
                await setDoc(progressDocRef, { unlockedLessonIndex: 0 });
                unlockedLessonIndex = 0;
            }
            console.log("Loaded lesson progress:", unlockedLessonIndex);
            renderLessonsList(); // Re-render lessons to reflect loaded progress
        } catch (error) {
            console.error("Error loading lesson progress from Firestore:", error);
            showAlert("Failed to load lesson progress. Please try again later.");
        }
    }

    async function saveLessonProgress(newIndex) {
        if (!window.db || !window.currentUserId) {
            console.warn("Firestore not initialized or user not authenticated. Cannot save lesson progress.");
            return;
        }
        try {
            const progressDocRef = doc(window.db, `artifacts/${window.appId}/users/${window.currentUserId}/progress/lesson_progress`);
            await setDoc(progressDocRef, { unlockedLessonIndex: newIndex }, { merge: true });
            unlockedLessonIndex = newIndex;
            console.log("Saved lesson progress:", newIndex);
            renderLessonsList(); // Re-render lessons to reflect new progress
        } catch (error) {
            console.error("Error saving lesson progress to Firestore:", error);
            showAlert("Failed to save lesson progress. Please check your internet connection.");
        }
    }

    function renderLessonsList() {
        lessonsCategoryList.innerHTML = ''; // Clear category list
        lessonsList.innerHTML = ''; // Clear lesson list
        lessonsCategoryList.classList.remove('hidden'); // Show category list
        lessonsList.classList.add('hidden'); // Hide lesson list
        backToCategoriesButton.classList.add('hidden'); // Hide back button
        lessonsCategoryTitle.textContent = 'Select a category:';

        // Render category buttons
        for (const category in lessonsData) {
            const listItem = document.createElement('li');
            const categoryButton = document.createElement('button');
            categoryButton.textContent = category;
            categoryButton.addEventListener('click', () => showCategoryLessons(category));
            listItem.appendChild(categoryButton);
            lessonsCategoryList.appendChild(listItem);
        }

        // Ensure quiz/back buttons are hidden when the category list is shown
        takeQuizButton.classList.add('hidden');
        backToLessonsListButton.classList.add('hidden');
    }

    function showCategoryLessons(categoryName) {
        currentCategory = categoryName; // Set the current category
        lessonsCategoryList.classList.add('hidden'); // Hide category list
        lessonsList.classList.remove('hidden'); // Show lesson list
        backToCategoriesButton.classList.remove('hidden'); // Show back to categories button
        lessonsCategoryTitle.textContent = `Lessons in ${categoryName}:`;

        lessonsList.innerHTML = ''; // Clear previous lessons
        const categoryLessons = lessonsData[categoryName];

        // Find the global index of the first lesson in this category
        let startIndex = 0;
        let foundCategory = false;
        for (const cat in lessonsData) {
            if (cat === categoryName) {
                foundCategory = true;
                break;
            }
            startIndex += lessonsData[cat].length;
        }

        categoryLessons.forEach((lesson, index) => {
            const globalIndex = startIndex + index; // Calculate global index for progress tracking
            const listItem = document.createElement('li');
            const lessonButton = document.createElement('button');
            lessonButton.textContent = lesson.title;
            
            // Disable button if lesson is not yet unlocked based on global index
            if (globalIndex > unlockedLessonIndex) {
                lessonButton.disabled = true;
                lessonButton.textContent += ' (Locked)';
            } else {
                lessonButton.addEventListener('click', () => viewLesson(lesson.id));
            }
            listItem.appendChild(lessonButton);
            lessonsList.appendChild(listItem);
        });

        // Ensure quiz/back buttons are hidden when the lesson list is shown
        takeQuizButton.classList.add('hidden');
        backToLessonsListButton.classList.add('hidden');
    }


    function viewLesson(lessonId) {
        // Find the lesson across all categories
        currentLesson = null;
        for (const category in lessonsData) {
            const found = lessonsData[category].find(lesson => lesson.id === lessonId);
            if (found) {
                currentLesson = found;
                break;
            }
        }

        if (currentLesson) {
            currentLessonTitle.textContent = currentLesson.title;
            currentLessonContent.innerHTML = currentLesson.content; // Use innerHTML for rich content

            const videoContainer = lessonContentSection.querySelector('.video-placeholder'); // Use lessonContentSection
            if (currentLesson.videoUrl) {
                lessonVideo.src = currentLesson.videoUrl;
                videoContainer.classList.remove('hidden');
            } else {
                lessonVideo.src = ''; // Clear source
                videoContainer.classList.add('hidden');
            }

            showSection('lesson-content-section'); // Show the new lesson content section
            
            // Show/hide take quiz button based on if the lesson has quiz data
            if (currentLesson.quiz && currentLesson.quiz.length > 0) {
                takeQuizButton.classList.remove('hidden');
            } else {
                takeQuizButton.classList.add('hidden');
            }
            
            // Always show the "Back to Lessons" button when viewing a specific lesson
            backToLessonsListButton.classList.remove('hidden');

        } else {
            showAlert('Lesson not found!');
            // Ensure buttons are hidden if lesson not found
            takeQuizButton.classList.add('hidden');
            backToLessonsListButton.classList.add('hidden');
        }
    }

    function startQuiz() {
        if (!currentLesson || !currentLesson.quiz || currentLesson.quiz.length === 0) {
            showAlert('No quiz available for this lesson.');
            return;
        }

        currentQuiz = currentLesson.quiz;
        quizTitle.textContent = `Quiz for: ${currentLesson.title}`;
        quizQuestionsContainer.innerHTML = ''; // Clear previous questions

        currentQuiz.forEach((q, qIdx) => {
            const questionDiv = document.createElement('div');
            questionDiv.classList.add('quiz-question');
            questionDiv.innerHTML = `<p><strong>${qIdx + 1}. ${q.question}</strong></p>`; // Added question numbering

            q.options.forEach((opt, oIdx) => {
                const label = document.createElement('label');
                label.classList.add('quiz-option');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question-${qIdx}`; // Unique name for each question
                input.value = oIdx; // Store index as value
                label.appendChild(input);
                label.append(opt); // Display the option text
                questionDiv.appendChild(label);
            });
            quizQuestionsContainer.appendChild(questionDiv);
        });

        showSection('quiz-section'); // Show the quiz section
    }

    async function submitQuiz() {
        if (currentLesson === null) return; // Ensure a lesson is selected
        const quizData = currentLesson.quiz; // Use currentLesson.quiz directly
        let score = 0;
        let totalQuestions = quizData.length;
        
        // Find the global index of the current lesson for progress tracking
        let currentLessonGlobalIndex = -1;
        let tempFlatIndex = 0;
        for (const category in lessonsData) {
            for (let i = 0; i < lessonsData[category].length; i++) {
                if (lessonsData[category][i].id === currentLesson.id) {
                    currentLessonGlobalIndex = tempFlatIndex;
                    break;
                }
                tempFlatIndex++;
            }
            if (currentLessonGlobalIndex !== -1) break;
        }

        quizData.forEach((q, idx) => {
            const selected = document.querySelector(`input[name="question-${idx}"]:checked`);
            if (selected && parseInt(selected.value) === q.correct) {
                score++;
            }
        });

        if (score === totalQuestions) {
            showAlert('Congratulations! You passed the quiz. All questions answered correctly.', async () => {
                // Unlock the next lesson if this one is the current highest unlocked
                if (currentLessonGlobalIndex + 1 > unlockedLessonIndex) {
                    await saveLessonProgress(currentLessonGlobalIndex + 1);
                }
                showCategoryLessons(currentCategory); // Go back to the lessons list within the current category
            });
        } else {
            showAlert(`Try again after reviewing the material. You scored ${score} out of ${totalQuestions}.`, () => {
                viewLesson(currentLesson.id); // Go back to lesson content
            });
        }
    }

    // --- Rosary Functions ---
    function ordinal(n) {
        const ord = ['First', 'Second', 'Third', 'Fourth', 'Fifth'];
        return ord[n - 1];
    }

    function startRosary(type) {
        let mysteries;
        let sectionId = type.toLowerCase() + '-rosary-section'; // Use existing section IDs
        let displayId = type.toLowerCase() + '-display'; // Use existing display IDs

        switch (type) {
            case 'Joyful': mysteries = joyfulMysteries; break;
            case 'Sorrowful': mysteries = sorrowfulMysteries; break;
            case 'Glorious': mysteries = gloriousMysteries; break;
            case 'Luminous': mysteries = luminousMysteries; break;
            default: return; // Should not happen
        }
        
        showSection(sectionId); // Show the specific rosary section

        let sequence = [];
        // Introductory Prayers
        sequence.push({type: 'prayer', name: 'Sign of the Cross', text: prayersData['Sign of the Cross']});
        sequence.push({type: 'prayer', name: 'Apostles\' Creed', text: prayersData['Apostles\' Creed']});
        sequence.push({type: 'prayer', name: 'Our Father', text: prayersData['Our Father']});
        for (let i = 0; i < 3; i++) {
            sequence.push({type: 'prayer', name: 'Hail Mary', text: prayersData['Hail Mary'], count: i + 1, total: 3});
        }
        sequence.push({type: 'prayer', name: 'Glory Be', text: prayersData['Glory Be']});
        sequence.push({type: 'prayer', name: 'Fatima Prayer', text: prayersData['Fatima Prayer']});

        // Mysteries and Decades
        for (let m = 0; m < 5; m++) {
            sequence.push({type: 'mystery', name: `${ordinal(m + 1)} ${type} Mystery: ${mysteries[m].name}`, scripture: mysteries[m].scripture});
            sequence.push({type: 'prayer', name: 'Our Father', text: prayersData['Our Father']});
            for (let i = 0; i < 10; i++) {
                sequence.push({type: 'prayer', name: 'Hail Mary', text: prayersData['Hail Mary'], count: i + 1, total: 10});
            }
            sequence.push({type: 'prayer', name: 'Glory Be', text: prayersData['Glory Be']});
            sequence.push({type: 'prayer', name: 'Fatima Prayer', text: prayersData['Fatima Prayer']});
        }
        
        // Concluding Prayer
        sequence.push({type: 'prayer', name: 'Hail Holy Queen', text: prayersData['Hail Holy Queen']});
        sequence.push({type: 'prayer', name: 'Sign of the Cross', text: prayersData['Sign of the Cross']}); // End with Sign of the Cross

        rosaryStates[type.toLowerCase()] = {sequence: sequence, index: 0, displayId: displayId};
        displayCurrentPrayer(type.toLowerCase());

        // Ensure next/back buttons are visible for the specific rosary section
        document.getElementById(`${type.toLowerCase()}-next-button`).classList.remove('hidden');
        document.getElementById(`${type.toLowerCase()}-rosary-section`).querySelector('button[onclick="showSection(\'rosary-main-section\')"]').classList.remove('hidden');
        document.getElementById(`${type.toLowerCase()}-rosary-section`).querySelector('button[onclick="showSection(\'spiritual-formation-section\')"]').classList.remove('hidden');
    }

    function nextPrayer(type) {
        let state = rosaryStates[type];
        if (!state) return;
        
        state.index++;
        if (state.index >= state.sequence.length) {
            showAlert('Rosary Completed! 🙏', () => {
                document.getElementById(state.displayId).innerHTML = '<p>Rosary Completed. Amen.</p>';
                // Reset state after completion
                state.index = 0;
                showSection('rosary-main-section'); // Go back to the main rosary selection
            });
            return;
        }
        displayCurrentPrayer(type);
    }

    function displayCurrentPrayer(type) {
        let state = rosaryStates[type];
        let item = state.sequence[state.index];
        let html = '';
        let displayElement = document.getElementById(state.displayId);

        if (!displayElement) {
            console.error(`Display element with ID "${state.displayId}" not found.`);
            return;
        }

        if (item.type === 'mystery') {
            html = `<h3>${item.name}</h3><pre class="scripture">${item.scripture}</pre>`;
        } else {
            let prayerName = item.name;
            if (item.count) {
                prayerName += ` (${item.count}/${item.total})`;
            }
            html = `<h3>${prayerName}</h3><pre class="rosary-current-prayer">${item.text}</pre>`;
        }
        displayElement.innerHTML = html;
    }

    function resetRosary(type) { // Added type parameter for specific reset
        showAlert("Rosary progress reset!", () => {
            if (rosaryStates[type]) {
                rosaryStates[type].index = 0; // Reset index for the specific type
            }
            showSection('rosary-main-section'); // Go back to the spiritual main menu
        });
    }

    // --- Common Prayers Functions ---
    function renderPrayersList() {
        prayersListContainer.innerHTML = '';
        for (const prayerName in prayersData) {
            const listItem = document.createElement('li');
            const prayerButton = document.createElement('button');
            prayerButton.textContent = prayerName;
            prayerButton.addEventListener('click', () => viewPrayer(prayerName));
            listItem.appendChild(prayerButton);
            prayersListContainer.appendChild(listItem);
        }
    }

    function viewPrayer(prayerName) {
        const prayerContent = prayersData[prayerName];
        if (prayerContent) {
            prayerTextElement.innerHTML = `<h3>${prayerName}</h3><p>${prayerContent.replace(/\n/g, '<br>')}</p>`;
            document.getElementById('prayers-list').classList.add('hidden');
            prayerTextElement.classList.remove('hidden');
            backToPrayersListButton.classList.remove('hidden');
        } else {
            showAlert('Prayer not found.');
        }
    }

    // --- Firebase User Profile Functions ---
    async function loadUserProfile() {
        if (!window.db || !window.currentUserId) {
            console.warn("Firestore not initialized or user not authenticated. Cannot load user profile.");
            return;
        }
        try {
            const profileDocRef = doc(window.db, `artifacts/${window.appId}/users/${window.currentUserId}/profile/user_data`);
            const profileSnap = await getDoc(profileDocRef);
            if (profileSnap.exists()) {
                const data = profileSnap.data();
                window.currentUsername = data.username || 'Guest';
                window.currentUserClass = data.userClass || 'N/A';
                usernameInput.value = window.currentUsername;
                classInput.value = window.currentUserClass;
            } else {
                // If no profile, set default and save it
                window.currentUsername = 'Guest';
                window.currentUserClass = 'N/A';
                usernameInput.value = window.currentUsername;
                classInput.value = window.currentUserClass;
                await saveUserProfile(); // Save initial profile
            }
            updateChatUserIdDisplay();
            console.log("User profile loaded:", window.currentUsername, window.currentUserClass);
        } catch (error) {
            console.error("Error loading user profile from Firestore:", error);
            showAlert("Failed to load user profile. Chat functionality might be limited.");
        }
    }

    async function saveUserProfile() {
        if (!window.db || !window.currentUserId) {
            showAlert("Firebase not initialized or user not authenticated. Cannot save profile.");
            return;
        }
        const username = usernameInput.value.trim();
        const userClass = classInput.value.trim();

        if (username && userClass) {
            try {
                const profileDocRef = doc(window.db, `artifacts/${window.appId}/users/${window.currentUserId}/profile/user_data`);
                await setDoc(profileDocRef, {
                    username: username,
                    userClass: userClass,
                    lastUpdated: serverTimestamp()
                }, { merge: true });
                window.currentUsername = username;
                window.currentUserClass = userClass;
                updateChatUserIdDisplay();
                showAlert('Profile saved successfully!');
            } catch (error) {
                console.error("Error saving user profile to Firestore:", error);
                showAlert("Failed to save profile. Error: " + error.message);
            }
        } else {
            showAlert('Please enter both username and class to save your profile.');
        }
    }

    function updateChatUserIdDisplay() {
        if (chatUserIdDisplay) {
            chatUserIdDisplay.textContent = `User ID: ${window.currentUserId || 'N/A'}`;
        }
        if (chatUsernameDisplay) {
            chatUsernameDisplay.textContent = `Username: ${window.currentUsername || 'Guest'}`;
        }
        if (chatClassDisplay) {
            chatClassDisplay.textContent = `Class: ${window.currentUserClass || 'N/A'}`;
        }
    }

    // --- Firebase Chat Functions ---
    function setupChatListener() {
        if (!window.db) {
            console.warn("Firestore not initialized. Cannot set up chat listener.");
            return;
        }
        try {
            const chatCollectionRef = collection(window.db, `artifacts/${window.appId}/public/data/chat_messages`);
            const q = query(chatCollectionRef, orderBy('timestamp')); // Order by timestamp for chronological display

            onSnapshot(q, (snapshot) => {
                if (loadingIndicator) { // Remove loading indicator once messages start loading
                    loadingIndicator.remove();
                }
                messagesArea.innerHTML = ''; // Clear existing messages
                snapshot.forEach((doc) => {
                    const messageData = doc.data();
                    const messageClass = messageData.userId === window.currentUserId ? 'sent' : 'received';
                    const senderName = messageData.username || 'Anonymous';
                    const senderClass = messageData.userClass ? ` (${messageData.userClass})` : '';
                    const messageHtml = `
                        <div class="message-bubble ${messageClass}">
                            <div class="message-sender">${senderName}${senderClass}</div>
                            ${messageData.text}
                        </div>
                    `;
                    messagesArea.innerHTML += messageHtml;
                });
                messagesArea.scrollTop = messagesArea.scrollHeight; // Scroll to bottom
            }, (error) => {
                console.error("Error listening to chat messages:", error);
                showAlert("Failed to load chat messages. Error: " + error.message);
                if (loadingIndicator) {
                    loadingIndicator.textContent = `Error loading chat: ${error.message}`;
                }
            });
        } catch (error) {
            console.error("Error setting up chat listener:", error);
            showAlert("Failed to set up chat listener. Please try again later.");
        }
    }

    async function sendMessage() {
        if (!window.db || !window.currentUserId) {
            showAlert("Please sign in or ensure Firebase is initialized to send messages.");
            return;
        }
        const messageText = userInput.value.trim();
        if (messageText === '') {
            return; // Don't send empty messages
        }

        try {
            const chatCollectionRef = collection(window.db, `artifacts/${window.appId}/public/data/chat_messages`);
            await addDoc(chatCollectionRef, {
                userId: window.currentUserId,
                username: window.currentUsername,
                userClass: window.currentUserClass,
                text: messageText,
                timestamp: serverTimestamp() // Use serverTimestamp for consistent timestamps
            });
            userInput.value = ''; // Clear input field
        } catch (error) {
            console.error("Error sending message:", error);
            showAlert("Failed to send message. Error: " + error.message);
        }
    }


    // --- Event Listeners ---
    function initListeners() {
        // Navigation Buttons
        if (homeNavButton) {
            homeNavButton.addEventListener('click', () => showSection('main-menu-section'));
        }
        if (lessonsNavButton) {
            lessonsNavButton.addEventListener('click', () => {
                currentCategory = null; // Reset current category when going to main lessons view
                renderLessonsList(); // Ensure categories are rendered
                showSection('lessons-list-section');
            });
        }
        if (spiritualNavButton) {
            spiritualNavButton.addEventListener('click', () => showSection('spiritual-formation-section'));
        }
        if (chatMenuButton) {
            chatMenuButton.addEventListener('click', () => showSection('chat-section'));
        }
        if (resourcesNavButton) {
            resourcesNavButton.addEventListener('click', () => showSection('student-resources-section'));
        }
        if (quitNavButton) {
            quitNavButton.addEventListener('click', () => showAlert('Are you sure you want to quit? This will close the application.', () => {
                window.close(); // Attempt to close the window/tab
            }));
        }

        // Lessons Section
        if (backToLessonsListButton) {
            backToLessonsListButton.addEventListener('click', () => {
                if (currentCategory) {
                    showCategoryLessons(currentCategory); // Go back to the lessons list within the current category
                } else {
                    renderLessonsList(); // Fallback to category list if no current category
                }
            });
        }
        if (backToCategoriesButton) {
            backToCategoriesButton.addEventListener('click', () => {
                currentCategory = null; // Clear current category
                renderLessonsList(); // Show the main category selection
            });
        }

        if (takeQuizButton) {
            takeQuizButton.addEventListener('click', startQuiz);
        }

        // Quiz Section
        if (submitQuizButton) {
            submitQuizButton.addEventListener('click', submitQuiz);
        }
        if (backToLessonFromQuizButton) {
            backToLessonFromQuizButton.addEventListener('click', () => {
                if (currentLesson) {
                    viewLesson(currentLesson.id); // Go back to the specific lesson content
                } else {
                    showCategoryLessons(currentCategory); // Fallback to lesson list in current category
                }
            });
        }

        // Chat Section
        if (sendButton) {
            sendButton.addEventListener('click', sendMessage);
        }
        if (userInput) {
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        if (saveProfileButton) {
            saveProfileButton.addEventListener('click', saveUserProfile);
        }

        // Spiritual Section (Rosary and Prayers List buttons)
        document.getElementById('rosary-main-section').querySelectorAll('button').forEach(button => {
            if (button.onclick && button.onclick.toString().includes('startRosary')) {
                const type = button.onclick.toString().match(/startRosary\('(\w+)'\)/)[1];
                button.addEventListener('click', () => startRosary(type));
            }
        });

        // Attach event listeners to the common Rosary navigation buttons within each rosary section
        document.getElementById('joyful-next-button')?.addEventListener('click', () => nextPrayer('joyful'));
        document.getElementById('sorrowful-next-button')?.addEventListener('click', () => nextPrayer('sorrowful'));
        document.getElementById('glorious-next-button')?.addEventListener('click', () => nextPrayer('glorious'));
        document.getElementById('luminous-next-button')?.addEventListener('click', () => nextPrayer('luminous'));

        // Reset buttons for each rosary type
        document.getElementById('joyful-rosary-section')?.querySelector('button[onclick*="showSection(\'rosary-main-section\')"]').addEventListener('click', () => resetRosary('joyful'));
        document.getElementById('sorrowful-rosary-section')?.querySelector('button[onclick*="showSection(\'rosary-main-section\')"]').addEventListener('click', () => resetRosary('sorrowful'));
        document.getElementById('glorious-rosary-section')?.querySelector('button[onclick*="showSection(\'rosary-main-section\')"]').addEventListener('click', () => resetRosary('glorious'));
        document.getElementById('luminous-rosary-section')?.querySelector('button[onclick*="showSection(\'rosary-main-section\')"]').addEventListener('click', () => resetRosary('luminous'));


        // Prayers specific listeners
        renderPrayersList(); // Render the prayer list initially
        if (backToPrayersListButton) {
            backToPrayersListButton.addEventListener('click', resetPrayer);
        }
    }

    // --- Initializations ---
    // Handle initial user profile load
    window.addEventListener('load', () => {
        // Firebase initialization is handled in the <script type="module"> block in the head
        // The onAuthStateChanged listener will trigger loadUserProfile and loadLessonProgress
        // and then setupChatListener.
        initListeners(); // Initialize all event listeners that don't depend on Firebase being fully ready
    });

    // Dummy resetPrayer function, replace with actual logic if needed
    function resetPrayer() {
        document.getElementById('prayers-list').classList.remove('hidden');
        document.getElementById('prayers-list').style.display = 'flex'; // Ensure it's display flex
        prayerTextElement.classList.add('hidden');
        prayerTextElement.style.display = 'none'; // Ensure it's hidden
        backToPrayersListButton.classList.add('hidden');
        backToPrayersListButton.style.display = 'none'; // Ensure it's hidden
    }

</script>

</body>
</html>
